12/20/2025



import React, { useState, useEffect } from 'react';

// Eye Icon Component
const EyeIcon = ({ visible }) => (
  visible ? (
    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-5 0-9-4-9-7s4-7 9-7a9.964 9.964 0 014.031.84M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3l18 18" />
    </svg>
  ) : (
    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c5 0 9 4 9 7 0 1.18-.293 2.29-.805 3.286M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
  )
);

// Message Component
const Message = ({ message, type, onClose }) => (
  <div className={`p-4 mb-4 rounded-lg shadow-md flex items-center justify-between ${type === 'error' ? 'bg-red-100 text-red-700 border border-red-300' :
      type === 'success' ? 'bg-green-100 text-green-700 border border-green-300' :
        'bg-blue-100 text-blue-700 border border-blue-300'
    }`}>
    <div className="flex items-center">
      <span className={`mr-3 ${type === 'error' ? 'text-red-500' :
          type === 'success' ? 'text-green-500' : 'text-blue-500'
        }`}>
        {type === 'error' ? '⚠️' : type === 'success' ? '✅' : 'ℹ️'}
      </span>
      <span className="text-sm font-medium">{message}</span>
    </div>
    <button
      onClick={onClose}
      className="ml-4 text-gray-500 hover:text-gray-700 transition-colors duration-200"
      aria-label="Close message"
    >
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
);

// Modal Component
const Modal = ({ isOpen, onClose, title, children }) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md">
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-2xl font-bold text-gray-800">{title}</h2>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded-full hover:bg-gray-100"
            aria-label="Close modal"
          >
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        {children}
      </div>
    </div>
  );
};

// Password Strength Indicator
const PasswordStrength = ({ strength }) => {
  const strengthLabels = ['Very Weak', 'Weak', 'Medium', 'Strong', 'Very Strong'];
  const strengthColors = ['bg-red-500', 'bg-red-500', 'bg-yellow-500', 'bg-green-500', 'bg-green-600'];

  return (
    <div className="mt-2">
      <div className="flex items-center mb-1">
        <div className="w-full bg-gray-200 rounded-full h-2">
          <div
            className={`h-2 rounded-full transition-all duration-300 ${strengthColors[strength] || 'bg-red-500'}`}
            style={{ width: `${(strength / 4) * 100}%` }}
          ></div>
        </div>
      </div>
      <p className="text-xs text-gray-600 font-medium">
        {strengthLabels[strength] || 'Very Weak'}
      </p>
    </div>
  );
};

// Illustration Component for Authentication
const AuthIllustration = ({ type }) => {
  if (type === 'signup') {
    return (
      <div className="relative w-full h-48 mb-6 flex items-center justify-center">
        <div className="absolute inset-0 bg-gradient-to-r from-purple-400/20 to-indigo-400/20 rounded-2xl"></div>
        <div className="relative z-10 text-center">
          <div className="w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg">
            <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <h3 className="text-xl font-bold text-gray-800">Join Our Community</h3>
          <p className="text-gray-600 text-sm mt-2">Create your account and get started</p>
        </div>
      </div>
    );
  }

  return (
    <div className="relative w-full h-48 mb-6 flex items-center justify-center">
      <div className="absolute inset-0 bg-gradient-to-r from-blue-400/20 to-cyan-400/20 rounded-2xl"></div>
      <div className="relative z-10 text-center">
        <div className="w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-full flex items-center justify-center shadow-lg">
          <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
        </div>
        <h3 className="text-xl font-bold text-gray-800">Welcome Back</h3>
        <p className="text-gray-600 text-sm mt-2">Sign in to continue your journey</p>
      </div>
    </div>
  );
};

// Social Login Buttons
const SocialLoginButtons = () => (
  <div className="space-y-3 mb-6">
    <button
      type="button"
      className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition duration-200 shadow-sm"
      aria-label="Sign in with Google"
    >
      <svg className="w-5 h-5" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
      </svg>
      Continue with Google
    </button>
  </div>
);

const AuthForm = () => {
  // Navigation function
  const safeNavigate = (path) => {
    if (typeof window === 'undefined') return;

    try {
      // SPA-style navigation so routers can pick it up
      window.history.pushState({}, '', path);
      window.dispatchEvent(new PopStateEvent('popstate'));
    } catch (e) {
      // Fallback to full navigation
      window.location.href = path;
    }
  };

  // State management
  const [currentUser, setCurrentUser] = useState(null);
  const [activeForm, setActiveForm] = useState('signup');
  const [showForgotPassword, setShowForgotPassword] = useState(false);
  const [showVerification, setShowVerification] = useState(false);
  const [messages, setMessages] = useState([]);
  const [pendingVerification, setPendingVerification] = useState(null);

  // Form data states
  const [loginData, setLoginData] = useState({ email: '', password: '' });
  const [signupData, setSignupData] = useState({
    name: '', email: '', password: '', confirmPassword: ''
  });
  const [forgotEmail, setForgotEmail] = useState('');
  const [verificationCode, setVerificationCode] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [termsAccepted, setTermsAccepted] = useState(false);

  // Captcha state
  const [captcha, setCaptcha] = useState({ question: '', answer: 0 });
  const [captchaInput, setCaptchaInput] = useState('');
  const [signupCaptchaInput, setSignupCaptchaInput] = useState('');

  // Password strength
  const [passwordStrength, setPasswordStrength] = useState(0);

  // Password visibility
  const [passwordVisible, setPasswordVisible] = useState({
    login: false,
    signup: false,
    confirm: false
  });

  // Form validation states
  const [formErrors, setFormErrors] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  // ✅ FIXED: API Configuration - Corrected function call
  const getApiBaseUrl = () => {
    // 1. runtime-injected value (useful when server injects config)
    if (typeof window !== 'undefined' && window.__REACT_APP_API_BASE_URL__) {
      let url = String(window.__REACT_APP_API_BASE_URL__).trim().replace(/\/+$/, '');
      if (!url.endsWith('/api')) url = `${url}/api`;
      console.log('Using runtime-injected REACT_APP_API_BASE_URL:', url);
      return url;
    }

    // 2. build-time env var (CRA/Vite style)
        if (typeof process !== 'undefined' && process && process.env && process.env.REACT_APP_API_BASE_URL && String(process.env.REACT_APP_API_BASE_URL).trim() !== '') {
          let url = String(process.env.REACT_APP_API_BASE_URL).trim().replace(/\/+$/, '');
          if (!url.endsWith('/api')) url = `${url}/api`;
    
          // expose API key (if present at build time) for client-side use
          const apiKey = (typeof process !== 'undefined' && process.env && process.env.REACT_APP_API_KEY) ? String(process.env.REACT_APP_API_KEY) : '';
          if (typeof window !== 'undefined') {
            window.__REACT_APP_API_KEY__ = apiKey;
          }
    
          console.log('Using build-time REACT_APP_API_BASE_URL:', url, 'REACT_APP_API_KEY present:', !!apiKey);
          return url;
        }

    // 3. development fallback
    if (typeof process !== 'undefined' && process && process.env && process.env.NODE_ENV === 'development') {
      const backendPort = process.env.REACT_APP_BACKEND_PORT ? String(process.env.REACT_APP_BACKEND_PORT) : '5000';
      const url = `http://localhost:${backendPort}/api`;
      console.log('Using development backend URL:', url);
      return url;
    }

    // 4. production same-origin
    if (typeof window !== 'undefined') {
      const url = `${window.location.origin}/api`;
      console.log('Using production backend URL (same origin):', url);
      return url;
    }

    // 5. final hardcoded fallback matching backend/.env.local
    return 'http://localhost:5000/api';
  };

  const API_BASE_URL = getApiBaseUrl(); // ✅ REMOVED: Incorrect argument

  // ✅ API routes configuration
  const API_ROUTES = {
    LOGIN: `${API_BASE_URL}/auth/login`,
    REGISTER: `${API_BASE_URL}/auth/register`,
    VERIFY_EMAIL: `${API_BASE_URL}/auth/verify-email`,
    FORGOT_PASSWORD: `${API_BASE_URL}/auth/forgot-password`,
    SEND_VERIFICATION: `${API_BASE_URL}/auth/send-verification`,
    ME: `${API_BASE_URL}/auth/me`,
    LOGOUT: `${API_BASE_URL}/auth/logout`,
    HEALTH: `${API_BASE_URL.replace('/api', '')}/health`,
  };

  console.log('API Configuration:', {
    API_BASE_URL,
    API_ROUTES,
    NODE_ENV: (typeof process !== 'undefined' && process.env) ? process.env.NODE_ENV : undefined,
    REACT_APP_API_BASE_URL: (typeof process !== 'undefined' && process.env) ? process.env.REACT_APP_API_BASE_URL : undefined
  });

  // Form validation functions
  const validateEmail = (email) => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  };

  const validatePassword = (password) => {
    return password.length >= 8;
  };

  const validateLoginForm = () => {
    const errors = {};

    if (!loginData.email) {
      errors.email = 'Email is required';
    } else if (!validateEmail(loginData.email)) {
      errors.email = 'Please enter a valid email address';
    }

    if (!loginData.password) {
      errors.password = 'Password is required';
    }

    if (!captchaInput) {
      errors.captcha = 'Captcha answer is required';
    } else if (parseInt(captchaInput, 10) !== captcha.answer) {
      errors.captcha = 'Incorrect captcha answer';
    }

    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const validateSignupForm = () => {
    const errors = {};

    if (!signupData.name?.trim()) {
      errors.name = 'Full name is required';
    } else if (signupData.name.trim().length < 2) {
      errors.name = 'Name must be at least 2 characters long';
    }

    if (!signupData.email) {
      errors.email = 'Email is required';
    } else if (!validateEmail(signupData.email)) {
      errors.email = 'Please enter a valid email address';
    }

    if (!signupData.password) {
      errors.password = 'Password is required';
    } else if (!validatePassword(signupData.password)) {
      errors.password = 'Password must be at least 8 characters long';
    } else if (checkPasswordStrength(signupData.password) < 3) {
      errors.password = 'Password is too weak. Please use a stronger password.';
    }

    if (!signupData.confirmPassword) {
      errors.confirmPassword = 'Please confirm your password';
    } else if (signupData.password !== signupData.confirmPassword) {
      errors.confirmPassword = 'Passwords do not match';
    }

    if (!signupCaptchaInput) {
      errors.captcha = 'Captcha answer is required';
    } else if (parseInt(signupCaptchaInput, 10) !== captcha.answer) {
      errors.captcha = 'Incorrect captcha answer';
    }

    if (!termsAccepted) {
      errors.terms = 'You must accept the terms and conditions';
    }

    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  // Generate Captcha
  const generateCaptcha = () => {
    const num1 = Math.floor(Math.random() * 10) + 1;
    const num2 = Math.floor(Math.random() * 10) + 1;
    return {
      question: `${num1} + ${num2} = ?`,
      answer: num1 + num2
    };
  };

  // Initialize component
  useEffect(() => {
    setCaptcha(generateCaptcha());

    // Check for remembered user
    try {
      const rememberedUser = JSON.parse(localStorage.getItem('rememberedUser') || 'null');
      if (rememberedUser) {
        setLoginData({
          email: rememberedUser.email,
          password: rememberedUser.password || ''
        });
        setRememberMe(true);
      }
    } catch (e) {
      console.warn('Error parsing remembered user:', e);
    }
  }, []);

  // Reset forms when switching between login/signup
  useEffect(() => {
    setCaptcha(generateCaptcha());
    setCaptchaInput('');
    setSignupCaptchaInput('');
    setFormErrors({});
  }, [activeForm]);

  // Toggle Password Visibility
  const togglePasswordVisibility = (field) => {
    setPasswordVisible(prev => ({
      ...prev,
      [field]: !prev[field]
    }));
  };

  // Check Password Strength
  const checkPasswordStrength = (password) => {
    let strength = 0;

    if (password.length >= 8) strength++;
    if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
    if (password.match(/[0-9]/)) strength++;
    if (password.match(/[^a-zA-Z0-9]/)) strength++;

    setPasswordStrength(strength);
    return strength;
  };

  // Generate Strong Password
  const generatePassword = () => {
    const lowercase = 'abcdefghijklmnopqrstuvwxyz';
    const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const numbers = '0123456789';
    const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';

    let password = '';
    password += lowercase[Math.floor(Math.random() * lowercase.length)];
    password += uppercase[Math.floor(Math.random() * uppercase.length)];
    password += numbers[Math.floor(Math.random() * numbers.length)];
    password += symbols[Math.floor(Math.random() * symbols.length)];

    const allChars = lowercase + uppercase + numbers + symbols;
    for (let i = 4; i < 12; i++) {
      password += allChars[Math.floor(Math.random() * allChars.length)];
    }

    password = password.split('').sort(() => Math.random() - 0.5).join('');

    setSignupData(prev => ({
      ...prev,
      password,
      confirmPassword: password
    }));

    checkPasswordStrength(password);
    showMessage('Strong password generated!', 'success');
  };

  // Show Message
  const showMessage = (message, type = 'info') => {
    const id = Date.now();
    setMessages(prev => [...prev, { id, message, type }]);

    setTimeout(() => {
      setMessages(prev => prev.filter(msg => msg.id !== id));
    }, 5000);
  };

  // ✅ API call function with better error handling
  const apiCall = async (endpoint, method = 'GET', data = null, timeoutMs = 10000) => {
    const controller = new AbortController();
    const timer = setTimeout(() => controller.abort(), timeoutMs);

    try {
      const options = {
        method,
        headers: { 
          'Content-Type': 'application/json',
        },
        credentials: 'include',
        signal: controller.signal,
      };
      
      if (data && (method === 'POST' || method === 'PUT')) {
        options.body = JSON.stringify(data);
      }

      console.log(`API Call: ${method} ${endpoint}`, data);

      const res = await fetch(endpoint, options);
      clearTimeout(timer);

      let payload = null;
      const contentType = res.headers.get('content-type') || '';

      try {
        if (contentType.includes('application/json')) {
          payload = await res.json();
        } else {
          payload = await res.text();
        }
      } catch (parseErr) {
        payload = await res.text().catch(() => null);
      }

      if (!res.ok) {
        const bodyMsg = typeof payload === 'string' ? payload : (payload?.error || payload?.message);
        const msg = bodyMsg || `${res.status} ${res.statusText}` || `Request failed: ${res.status}`;
        const err = new Error(msg);
        err.status = res.status;
        err.payload = payload;
        throw err;
      }

      return payload;
    } catch (err) {
      clearTimeout(timer);

      if (err.name === 'AbortError') {
        showMessage('Request timed out. Please try again.', 'error');
      } else if (err instanceof TypeError) {
        console.error('Network error:', err);
        showMessage('Cannot connect to server. Please check if the backend is running on port 5000.', 'error');
      } else {
        const serverMsg = err.payload?.error || err.payload?.message || err.message;
        showMessage(serverMsg || 'An error occurred. Please try again.', 'error');
      }

      throw err;
    }
  };

  // Form Handlers
  const handleLoginSubmit = async (e) => {
    e.preventDefault();

    if (!validateLoginForm()) return;

    setIsSubmitting(true);

    try {
      const result = await apiCall(API_ROUTES.LOGIN, 'POST', {
        email: loginData.email,
        password: loginData.password
      });

      const { user, token } = result;

      // Remember me functionality
      if (rememberMe) {
        localStorage.setItem('rememberedUser', JSON.stringify({
          email: loginData.email
        }));
        localStorage.setItem('authToken', token);
      } else {
        localStorage.removeItem('rememberedUser');
        sessionStorage.setItem('authToken', token);
      }

      setCurrentUser(user);
      showMessage('Login successful! Redirecting...', 'success');

      setTimeout(() => {
        safeNavigate('/');
      }, 1500);
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleSignupSubmit = async (e) => {
    e.preventDefault();

    if (!validateSignupForm()) return;

    setIsSubmitting(true);

    try {
      const result = await apiCall(API_ROUTES.REGISTER, 'POST', {
        name: signupData.name.trim(),
        email: signupData.email,
        password: signupData.password
      });

      setPendingVerification({ email: signupData.email });
      setShowVerification(true);
      showMessage('Account created! Please check your email for verification code.', 'success');
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleVerificationSubmit = async (e) => {
    e.preventDefault();

    if (!pendingVerification?.email) {
      showMessage('No pending verification found. Please register first.', 'error');
      return;
    }

    setIsSubmitting(true);

    try {
      await apiCall(API_ROUTES.VERIFY_EMAIL, 'POST', {
        email: pendingVerification.email,
        code: verificationCode
      });

      setShowVerification(false);
      setPendingVerification(null);
      setVerificationCode('');
      showMessage('Email verified successfully! Redirecting to login...', 'success');

      setTimeout(() => {
        setActiveForm('login');
      }, 1200);
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleForgotPasswordSubmit = async (e) => {
    e.preventDefault();

    if (!forgotEmail) {
      showMessage('Please enter your email address', 'error');
      return;
    }

    if (!validateEmail(forgotEmail)) {
      showMessage('Please enter a valid email address', 'error');
      return;
    }

    setIsSubmitting(true);

    try {
      await apiCall(API_ROUTES.FORGOT_PASSWORD, 'POST', {
        email: forgotEmail
      });

      showMessage('Password reset link sent to your email!', 'success');
      setShowForgotPassword(false);
      setForgotEmail('');
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  const resendVerificationCode = async () => {
    if (!pendingVerification?.email) {
      showMessage('No email to resend code to. Please register first.', 'error');
      return;
    }

    setIsSubmitting(true);

    try {
      await apiCall(API_ROUTES.SEND_VERIFICATION, 'POST', {
        email: pendingVerification.email
      });
      showMessage('Verification code resent to your email!', 'success');
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  // Input field components with error handling
  const InputField = ({
    id, label, type, value, onChange, placeholder, error,
    showPasswordToggle = false, onTogglePassword, passwordVisible = false
  }) => (
    <div>
      <label htmlFor={id} className="block text-sm font-medium text-gray-700 mb-1">
        {label}
      </label>
      <div className="relative">
        <input
          type={type}
          id={id}
          className={`w-full px-4 py-3 bg-white border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 ${error ? 'border-red-300' : 'border-gray-300'
            } ${showPasswordToggle ? 'pr-12' : ''}`}
          placeholder={placeholder}
          value={value}
          onChange={onChange}
          required
        />
        {showPasswordToggle && (
          <button
            type="button"
            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded"
            onClick={onTogglePassword}
            aria-label={passwordVisible ? "Hide password" : "Show password"}
          >
            <EyeIcon visible={passwordVisible} />
          </button>
        )}
      </div>
      {error && <p className="mt-1 text-sm text-red-600">{error}</p>}
    </div>
  );

  // Render Login Form
  const renderLoginForm = () => (
    <form onSubmit={handleLoginSubmit} className="space-y-6">
      <AuthIllustration type="login" />

      <SocialLoginButtons />

      <div className="relative flex items-center my-6">
        <div className="flex-grow border-t border-gray-300"></div>
        <span className="flex-shrink mx-4 text-gray-600 text-sm">Or continue with email</span>
        <div className="flex-grow border-t border-gray-300"></div>
      </div>

      <InputField
        id="email"
        label="Email Address"
        type="email"
        value={loginData.email}
        onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}
        placeholder="Enter your email"
        error={formErrors.email}
      />

      <InputField
        id="password"
        label="Password"
        type={passwordVisible.login ? "text" : "password"}
        value={loginData.password}
        onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}
        placeholder="Enter your password"
        error={formErrors.password}
        showPasswordToggle
        onTogglePassword={() => togglePasswordVisibility('login')}
        passwordVisible={passwordVisible.login}
      />

      <div className="flex items-center justify-between">
        <div className="flex items-center">
          <input
            type="checkbox"
            id="remember"
            className="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"
            checked={rememberMe}
            onChange={(e) => setRememberMe(e.target.checked)}
          />
          <label htmlFor="remember" className="ml-2 block text-sm text-gray-700">
            Remember me
          </label>
        </div>

        <button
          type="button"
          className="text-sm text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
          onClick={() => setShowForgotPassword(true)}
        >
          Forgot Password?
        </button>
      </div>

      <InputField
        id="captcha"
        label={`Security Check: ${captcha.question}`}
        type="number"
        value={captchaInput}
        onChange={(e) => setCaptchaInput(e.target.value)}
        placeholder="Enter the answer"
        error={formErrors.captcha}
      />

      <button
        type="submit"
        disabled={isSubmitting}
        className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
      >
        {isSubmitting ? 'Signing In...' : 'Sign In'}
      </button>

      <div className="text-center mt-4">
        <p className="text-sm text-gray-600">
          Don't have an account?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={() => setActiveForm('signup')}
          >
            Sign Up
          </button>
        </p>
      </div>
    </form>
  );

  // Render Signup Form
  const renderSignupForm = () => (
    <form onSubmit={handleSignupSubmit} className="space-y-6">
      <AuthIllustration type="signup" />

      <SocialLoginButtons />

      <div className="relative flex items-center my-6">
        <div className="flex-grow border-t border-gray-300"></div>
        <span className="flex-shrink mx-4 text-gray-600 text-sm">Or sign up with email</span>
        <div className="flex-grow border-t border-gray-300"></div>
      </div>

      <InputField
        id="name"
        label="Full Name"
        type="text"
        value={signupData.name}
        onChange={(e) => setSignupData({ ...signupData, name: e.target.value })}
        placeholder="Enter your full name"
        error={formErrors.name}
      />

      <InputField
        id="signup-email"
        label="Email Address"
        type="email"
        value={signupData.email}
        onChange={(e) => setSignupData({ ...signupData, email: e.target.value })}
        placeholder="Enter your email"
        error={formErrors.email}
      />

      <div>
        <div className="flex items-center justify-between mb-1">
          <label htmlFor="signup-password" className="block text-sm font-medium text-gray-700">
            Password
          </label>
          <button
            type="button"
            className="text-xs text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={generatePassword}
          >
            Generate Strong Password
          </button>
        </div>

        <InputField
          id="signup-password"
          type={passwordVisible.signup ? "text" : "password"}
          value={signupData.password}
          onChange={(e) => {
            setSignupData({ ...signupData, password: e.target.value });
            checkPasswordStrength(e.target.value);
          }}
          placeholder="Create a strong password"
          error={formErrors.password}
          showPasswordToggle
          onTogglePassword={() => togglePasswordVisibility('signup')}
          passwordVisible={passwordVisible.signup}
        />

        {signupData.password && (
          <PasswordStrength strength={passwordStrength} />
        )}
      </div>

      <InputField
        id="confirm-password"
        label="Confirm Password"
        type={passwordVisible.confirm ? "text" : "password"}
        value={signupData.confirmPassword}
        onChange={(e) => setSignupData({ ...signupData, confirmPassword: e.target.value })}
        placeholder="Confirm your password"
        error={formErrors.confirmPassword}
        showPasswordToggle
        onTogglePassword={() => togglePasswordVisibility('confirm')}
        passwordVisible={passwordVisible.confirm}
      />

      <InputField
        id="signup-captcha"
        label={`Security Check: ${captcha.question}`}
        type="number"
        value={signupCaptchaInput}
        onChange={(e) => setSignupCaptchaInput(e.target.value)}
        placeholder="Enter the answer"
        error={formErrors.captcha}
      />

      <div className="flex items-start">
        <input
          type="checkbox"
          id="terms"
          className="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded mt-1"
          checked={termsAccepted}
          onChange={(e) => setTermsAccepted(e.target.checked)}
          required
        />
        <label htmlFor="terms" className="ml-2 block text-sm text-gray-700">
          I agree to the <a href="#" className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200">Terms and Conditions</a>
        </label>
      </div>
      {formErrors.terms && <p className="text-sm text-red-600">{formErrors.terms}</p>}

      <button
        type="submit"
        disabled={isSubmitting}
        className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
      >
        {isSubmitting ? 'Creating Account...' : 'Create Account'}
      </button>

      <div className="text-center mt-4">
        <p className="text-sm text-gray-600">
          Already have an account?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={() => setActiveForm('login')}
          >
            Sign In
          </button>
        </p>
      </div>
    </form>
  );

  // Render Forgot Password Modal
  const renderForgotPasswordModal = () => (
    <Modal
      isOpen={showForgotPassword}
      onClose={() => setShowForgotPassword(false)}
      title="Reset Password"
    >
      <div className="text-center mb-4">
        <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center">
          <svg className="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
        </div>
      </div>

      <p className="text-gray-600 mb-6 text-center">
        Enter your email address and we'll send you a link to reset your password.
      </p>

      <form onSubmit={handleForgotPasswordSubmit} className="space-y-4">
        <InputField
          id="forgot-email"
          label="Email Address"
          type="email"
          value={forgotEmail}
          onChange={(e) => setForgotEmail(e.target.value)}
          placeholder="Enter your email"
        />

        <button
          type="submit"
          disabled={isSubmitting}
          className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {isSubmitting ? 'Sending...' : 'Send Reset Link'}
        </button>
      </form>
    </Modal>
  );

  // Render Verification Modal
  const renderVerificationModal = () => (
    <Modal
      isOpen={showVerification}
      onClose={() => {
        setShowVerification(false);
        setPendingVerification(null);
      }}
      title="Verify Your Email"
    >
      <div className="text-center mb-4">
        <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-100 to-teal-100 rounded-full flex items-center justify-center">
          <svg className="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
        </div>
      </div>

      <p className="text-gray-600 mb-6 text-center">
        We've sent a verification code to <strong className="text-purple-600">{pendingVerification?.email}</strong>.
        Please enter the code below to verify your email address.
      </p>

      <form onSubmit={handleVerificationSubmit} className="space-y-4">
        <InputField
          id="verification-code"
          label="Verification Code"
          type="text"
          value={verificationCode}
          onChange={(e) => setVerificationCode(e.target.value)}
          placeholder="Enter verification code"
        />

        <button
          type="submit"
          disabled={isSubmitting}
          className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {isSubmitting ? 'Verifying...' : 'Verify Email'}
        </button>
      </form>

      <div className="text-center mt-4">
        <p className="text-sm text-gray-600">
          Didn't receive the code?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
            onClick={resendVerificationCode}
            disabled={isSubmitting}
          >
            {isSubmitting ? 'Resending...' : 'Resend Code'}
          </button>
        </p>
      </div>
    </Modal>
  );

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 p-4 relative overflow-hidden">
      {/* Background decorative elements */}
      <div className="absolute inset-0 overflow-hidden">
        <div className="absolute -top-40 -right-40 w-80 h-80 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>
        <div className="absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>
        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20"></div>
      </div>

      {/* Main Container */}
      <div className="w-full max-w-md relative z-10">
        {/* Auth Form Container */}
        <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl p-8 border border-white/30">
          {/* Logo/Header */}
          <div className="text-center mb-2">
            <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-full mb-4 shadow-lg">
              <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
            <h1 className="text-3xl font-bold text-gray-800">
              {activeForm === 'login' ? 'Welcome Back' : 'Join Dora'}
            </h1>
            <p className="text-gray-600 mt-2">
              {activeForm === 'login'
                ? 'Sign in to continue to your account'
                : 'Create your account to get started'}
            </p>
          </div>

          {/* Render the appropriate form */}
          {activeForm === 'login' ? renderLoginForm() : renderSignupForm()}
        </div>

        {/* Terms notice */}
        <div className="mt-6 text-center">
          <p className="text-xs text-white/80">
            By creating an account or continuing with Google, you agree to Dora's{' '}
            <a href="#" className="underline hover:text-white transition-colors">Terms & Conditions</a>{' '}
            and{' '}
            <a href="#" className="underline hover:text-white transition-colors">Privacy Policy</a>.
          </p>
        </div>
      </div>

      {/* Modals */}
      {renderForgotPasswordModal()}
      {renderVerificationModal()}

      {/* Success/Error Messages */}
      <div className="fixed top-4 right-4 z-50 max-w-sm w-full space-y-2">
        {messages.map(msg => (
          <Message
            key={msg.id}
            message={msg.message}
            type={msg.type}
            onClose={() => setMessages(prev => prev.filter(m => m.id !== msg.id))}
          />
        ))}
      </div>
    </div>
  );
};

export default AuthForm;

21/12/2025


import React, { useState, useEffect, useRef } from 'react';
import { useNavigate } from 'react-router-dom';

// Eye Icon Component
const EyeIcon = ({ visible }) => (
  visible ? (
    // eye-off icon
    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-5 0-9-4-9-7s4-7 9-7a9.964 9.964 0 014.031.84M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3l18 18" />
    </svg>
  ) : (
    // eye icon
    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c5 0 9 4 9 7 0 1.18-.293 2.29-.805 3.286M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
  )
);

// Message Component
const Message = ({ message, type, onClose }) => (
  <div
    role="status"
    aria-live="polite"
    className={`p-4 mb-4 rounded-lg shadow-md flex items-center justify-between ${type === 'error' ? 'bg-red-100 text-red-700 border border-red-300' :
      type === 'success' ? 'bg-green-100 text-green-700 border border-green-300' :
        'bg-blue-100 text-blue-700 border border-blue-300'
    }`}
  >
    <div className="flex items-center">
      <span className={`mr-3 ${type === 'error' ? 'text-red-500' :
        type === 'success' ? 'text-green-500' : 'text-blue-500'
      }`}>
        {type === 'error' ? '⚠️' : type === 'success' ? '✅' : 'ℹ️'}
      </span>
      <span className="text-sm font-medium">{message}</span>
    </div>
    <button
      type="button"
      onClick={onClose}
      className="ml-4 text-gray-500 hover:text-gray-700 transition-colors duration-200"
      aria-label="Close message"
    >
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
);

// Modal Component
const Modal = ({ isOpen, onClose, title, children }) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md">
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-2xl font-bold text-gray-800">{title}</h2>
          <button
            type="button"
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded-full hover:bg-gray-100"
            aria-label="Close modal"
          >
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        {children}
      </div>
    </div>
  );
};

// Password Strength Indicator
const PasswordStrength = ({ strength }) => {
  const strengthLabels = ['Very Weak', 'Weak', 'Medium', 'Strong', 'Very Strong'];
  const strengthColors = ['bg-red-500', 'bg-red-500', 'bg-yellow-500', 'bg-green-500', 'bg-green-600'];

  const percentage = Math.round((strength / 4) * 100);

  return (
    <div className="mt-2" aria-hidden="false">
      <div className="flex items-center mb-1">
        <div className="w-full bg-gray-200 rounded-full h-2">
          <div
            className={`h-2 rounded-full transition-all duration-300 ${strengthColors[strength] || 'bg-red-500'}`}
            style={{ width: `${percentage}%` }}
          />
        </div>
      </div>
      <p className="text-xs text-gray-600 font-medium">
        {strengthLabels[strength] || 'Very Weak'}
      </p>
    </div>
  );
};

// Illustration Component for Authentication
const AuthIllustration = ({ type }) => {
  if (type === 'signup') {
    return (
      <div className="relative w-full h-48 mb-6 flex items-center justify-center">
        <div className="absolute inset-0 bg-gradient-to-r from-purple-400/20 to-indigo-400/20 rounded-2xl" />
        <div className="relative z-10 text-center">
          <div className="w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg">
            <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <h3 className="text-xl font-bold text-gray-800">Join Our Community</h3>
          <p className="text-gray-600 text-sm mt-2">Create your account and get started</p>
        </div>
      </div>
    );
  }

  return (
    <div className="relative w-full h-48 mb-6 flex items-center justify-center">
      <div className="absolute inset-0 bg-gradient-to-r from-blue-400/20 to-cyan-400/20 rounded-2xl" />
      <div className="relative z-10 text-center">
        <div className="w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-full flex items-center justify-center shadow-lg">
          <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
        </div>
        <h3 className="text-xl font-bold text-gray-800">Welcome Back</h3>
        <p className="text-gray-600 text-sm mt-2">Sign in to continue your journey</p>
      </div>
    </div>
  );
};

// Input field component (supports forwarded ref)
const InputField = React.forwardRef(({
  id, label, type = 'text', value, onChange, placeholder, error,
  showPasswordToggle = false, onTogglePassword, passwordVisible = false, required = false, ...rest
}, ref) => (
  <div>
    {label && <label htmlFor={id} className="block text-sm font-medium text-gray-700 mb-1">{label}</label>}
    <div className="relative">
      <input
        ref={ref}
        id={id}
        type={type}
        className={`w-full px-4 py-3 bg-white border rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 ${error ? 'border-red-300' : 'border-gray-300'} ${showPasswordToggle ? 'pr-12' : ''}`}
        placeholder={placeholder}
        value={value}
        onChange={onChange}
        aria-invalid={!!error}
        aria-describedby={error ? `${id}-error` : undefined}
        required={required}
        {...rest}
      />
      {showPasswordToggle && (
        <button
          type="button"
          className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded"
          onClick={onTogglePassword}
          aria-label={passwordVisible ? "Hide password" : "Show password"}
        >
          <EyeIcon visible={passwordVisible} />
        </button>
      )}
    </div>
    {error && <p id={`${id}-error`} className="mt-1 text-sm text-red-600">{error}</p>}
  </div>
));
InputField.displayName = 'InputField';

// API Configuration function
const getApiBaseUrl = () => {
  if (typeof window !== 'undefined' && window.__REACT_APP_API_BASE_URL__) {
    let url = String(window.__REACT_APP_API_BASE_URL__).trim().replace(/\/+$/, '');
    if (!url.endsWith('/api')) url = `${url}/api`;
    return url;
  }

  if (typeof process !== 'undefined' && process && process.env && process.env.REACT_APP_API_BASE_URL && String(process.env.REACT_APP_API_BASE_URL).trim() !== '') {
    let url = String(process.env.REACT_APP_API_BASE_URL).trim().replace(/\/+$/, '');
    if (!url.endsWith('/api')) url = `${url}/api`;
    return url;
  }

  if (typeof process !== 'undefined' && process && process.env && process.env.NODE_ENV === 'development') {
    const backendPort = process.env.REACT_APP_BACKEND_PORT ? String(process.env.REACT_APP_BACKEND_PORT) : '5000';
    const url = `http://localhost:${backendPort}/api`;
    return url;
  }

  if (typeof window !== 'undefined') {
    const url = `${window.location.origin}/api`;
    return url;
  }

  return 'http://localhost:5000/api';
};

// Social Login Buttons Component
const SocialLoginButtons = () => {
  const base = getApiBaseUrl();

  const handleRedirect = (provider) => {
    // Example: /api/auth/google
    window.location.href = `${base}/auth/${provider}`;
  };

  return (
    <div className="space-y-3 mb-6" aria-label="Social sign-in options">
      <button
        type="button"
        onClick={() => handleRedirect('google')}
        className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition duration-200 shadow-sm"
        aria-label="Sign in with Google"
      >
        <svg className="w-5 h-5" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" />
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" />
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" />
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" />
        </svg>
        Continue with Google
      </button>

      <button
        type="button"
        onClick={() => handleRedirect('facebook')}
        className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition duration-200 shadow-sm"
        aria-label="Sign in with Facebook"
      >
        <svg className="w-5 h-5" viewBox="0 0 24 24" fill="#1877F2" aria-hidden="true">
          <path d="M24 12.073c0-6.627-5.373-12-12-12S0 5.446 0 12.073c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
        </svg>
        Continue with Facebook
      </button>

      <button
        type="button"
        onClick={() => handleRedirect('github')}
        className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition duration-200 shadow-sm"
        aria-label="Sign in with GitHub"
      >
        <svg className="w-5 h-5" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.207 11.387.6.11.793-.26.793-.577v-2.16C6.73 20.77 6.14 18.97 6.14 18.97c-.546-1.387-1.333-1.757-1.333-1.757-1.088-.744.083-.729.083-.729 1.204.085 1.838 1.235 1.838 1.235 1.07 1.834 2.809 1.305 3.494.998.108-.775.418-1.305.76-1.606-4.266-.486-8.75-2.133-8.75-9.496 0-2.098.75-3.812 1.98-5.158-.199-.487-.858-2.449.188-5.103 0 0 1.616-.518 5.29 1.97 1.536-.427 3.18-.64 4.82-.648 1.64.008 3.284.221 4.823.648 3.67-2.488 5.284-1.97 5.284-1.97 1.048 2.654.39 4.616.192 5.103 1.232 1.346 1.98 3.06 1.98 5.158 0 7.38-4.49 9.006-8.77 9.487.43.37.81 1.096.81 2.21v3.277c0 .32.19.694.8.576C20.565 21.796 24 17.298 24 12 24 5.37 18.63 0 12 0z" />
        </svg>
        Continue with GitHub
      </button>

      <button
        type="button"
        onClick={() => handleRedirect('microsoft')}
        className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition duration-200 shadow-sm"
        aria-label="Sign in with Microsoft"
      >
        <svg className="w-5 h-5" viewBox="0 0 24 24" aria-hidden="true">
          <rect x="1" y="1" width="10" height="10" fill="#f35325" />
          <rect x="13" y="1" width="10" height="10" fill="#81bc06" />
          <rect x="1" y="13" width="10" height="10" fill="#05a6f0" />
          <rect x="13" y="13" width="10" height="10" fill="#ffba08" />
        </svg>
        Continue with Microsoft
      </button>

      <button
        type="button"
        onClick={() => handleRedirect('apple')}
        className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition duration-200 shadow-sm"
        aria-label="Sign in with Apple"
      >
        <svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M16.365 1.43c0 1.02-.39 1.9-1.02 2.56-.66.67-1.7 1.32-2.9 1.09-.12-1.02.39-1.9 1.02-2.56.66-.67 1.7-1.32 2.9-1.09zM12 3.5c-2.21 0-3.98 1.77-3.98 3.98 0 2.2 1.77 3.97 3.98 3.97s3.98-1.77 3.98-3.97C15.98 5.27 14.21 3.5 12 3.5z" />
        </svg>
        Continue with Apple
      </button>
    </div>
  );
};

const AuthForm = () => {
  const navigate = useNavigate();
  const verificationInputRef = useRef(null);
  const loginPasswordRef = useRef(null);

  // State management
  const [currentUser, setCurrentUser] = useState(null);
  const [activeForm, setActiveForm] = useState('signup');
  const [showForgotPassword, setShowForgotPassword] = useState(false);
  const [showVerification, setShowVerification] = useState(false);
  const [messages, setMessages] = useState([]);
  const [pendingVerification, setPendingVerification] = useState(null);

  // Form data states
  const [loginData, setLoginData] = useState({ email: '', password: '' });
  const [signupData, setSignupData] = useState({
    name: '', email: '', password: '', confirmPassword: ''
  });
  const [forgotEmail, setForgotEmail] = useState('');
  const [verificationCode, setVerificationCode] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [termsAccepted, setTermsAccepted] = useState(false);

  // Captcha state
  const [captcha, setCaptcha] = useState({ question: '', answer: 0 });
  const [captchaInput, setCaptchaInput] = useState('');
  const [signupCaptchaInput, setSignupCaptchaInput] = useState('');

  // Password strength
  const [passwordStrength, setPasswordStrength] = useState(0);

  // Password visibility
  const [passwordVisible, setPasswordVisible] = useState({
    login: false,
    signup: false,
    confirm: false
  });

  // Form validation states
  const [formErrors, setFormErrors] = useState({});
  const [isSubmitting, setIsSubmitting] = useState(false);

  const API_BASE_URL = getApiBaseUrl();

  // API routes configuration
  const API_ROUTES = {
    LOGIN: `${API_BASE_URL}/auth/login`,
    REGISTER: `${API_BASE_URL}/auth/register`,
    VERIFY_EMAIL: `${API_BASE_URL}/auth/verify-email`,
    FORGOT_PASSWORD: `${API_BASE_URL}/auth/forgot-password`,
    SEND_VERIFICATION: `${API_BASE_URL}/auth/send-verification`,
    ME: `${API_BASE_URL}/auth/me`,
    LOGOUT: `${API_BASE_URL}/auth/logout`,
    HEALTH: `${API_BASE_URL.replace('/api', '')}/health`,
  };

  // Form validation functions
  const validateEmail = (email) => {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  };

  const validatePassword = (password) => {
    return password.length >= 8;
  };

  const validateLoginForm = () => {
    const errors = {};

    if (!loginData.email) {
      errors.email = 'Email is required';
    } else if (!validateEmail(loginData.email)) {
      errors.email = 'Please enter a valid email address';
    }

    if (!loginData.password) {
      errors.password = 'Password is required';
    }

    if (!captchaInput) {
      errors.captcha = 'Captcha answer is required';
    } else if (parseInt(captchaInput, 10) !== captcha.answer) {
      errors.captcha = 'Incorrect captcha answer';
    }

    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const validateSignupForm = () => {
    const errors = {};

    if (!signupData.name?.trim()) {
      errors.name = 'Full name is required';
    } else if (signupData.name.trim().length < 2) {
      errors.name = 'Name must be at least 2 characters long';
    }

    if (!signupData.email) {
      errors.email = 'Email is required';
    } else if (!validateEmail(signupData.email)) {
      errors.email = 'Please enter a valid email address';
    }

    if (!signupData.password) {
      errors.password = 'Password is required';
    } else if (!validatePassword(signupData.password)) {
      errors.password = 'Password must be at least 8 characters long';
    } else if (passwordStrength < 3) {
      errors.password = 'Password is too weak. Please use a stronger password.';
    }

    if (!signupData.confirmPassword) {
      errors.confirmPassword = 'Please confirm your password';
    } else if (signupData.password !== signupData.confirmPassword) {
      errors.confirmPassword = 'Passwords do not match';
    }

    if (!signupCaptchaInput) {
      errors.captcha = 'Captcha answer is required';
    } else if (parseInt(signupCaptchaInput, 10) !== captcha.answer) {
      errors.captcha = 'Incorrect captcha answer';
    }

    if (!termsAccepted) {
      errors.terms = 'You must accept the terms and conditions';
    }

    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  // Generate Captcha
  const generateCaptcha = () => {
    const num1 = Math.floor(Math.random() * 10) + 1;
    const num2 = Math.floor(Math.random() * 10) + 1;
    return {
      question: `${num1} + ${num2} = ?`,
      answer: num1 + num2
    };
  };

  // Initialize component
  useEffect(() => {
    setCaptcha(generateCaptcha());

    try {
      const rememberedUser = JSON.parse(localStorage.getItem('rememberedUser') || 'null');
      if (rememberedUser && rememberedUser.email) {
        setLoginData({
          email: rememberedUser.email,
          password: rememberedUser.password || ''
        });
        setRememberMe(true);
      }
    } catch (e) {
      console.warn('Error parsing remembered user:', e);
    }
  }, []);

  // Focus verification input when modal opens
  useEffect(() => {
    if (showVerification) {
      setTimeout(() => verificationInputRef.current?.focus(), 50);
    }
  }, [showVerification]);

  // Focus password when switching to login form
  useEffect(() => {
    if (activeForm === 'login') {
      setTimeout(() => loginPasswordRef.current?.focus(), 100);
    }
  }, [activeForm]);

  // Reset forms when switching between login/signup
  useEffect(() => {
    setCaptcha(generateCaptcha());
    setCaptchaInput('');
    setSignupCaptchaInput('');
    setFormErrors({});
  }, [activeForm]);

  // Toggle Password Visibility
  const togglePasswordVisibility = (field) => {
    setPasswordVisible(prev => ({
      ...prev,
      [field]: !prev[field]
    }));
  };

  // Check Password Strength
  const checkPasswordStrength = (password) => {
    let strength = 0;

    if (password.length >= 8) strength++;
    if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
    if (password.match(/[0-9]/)) strength++;
    if (password.match(/[^a-zA-Z0-9]/)) strength++;

    setPasswordStrength(Math.min(Math.max(strength, 0), 4));
    return strength;
  };

  // Generate Strong Password
  const generatePassword = () => {
    const lowercase = 'abcdefghijklmnopqrstuvwxyz';
    const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const numbers = '0123456789';
    const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';

    let password = '';
    password += lowercase[Math.floor(Math.random() * lowercase.length)];
    password += uppercase[Math.floor(Math.random() * uppercase.length)];
    password += numbers[Math.floor(Math.random() * numbers.length)];
    password += symbols[Math.floor(Math.random() * symbols.length)];

    const allChars = lowercase + uppercase + numbers + symbols;
    for (let i = 4; i < 12; i++) {
      password += allChars[Math.floor(Math.random() * allChars.length)];
    }

    password = password.split('').sort(() => Math.random() - 0.5).join('');

    setSignupData(prev => ({
      ...prev,
      password,
      confirmPassword: password
    }));

    checkPasswordStrength(password);
    showMessage('Strong password generated!', 'success');
  };

  // Show Message
  const showMessage = (message, type = 'info') => {
    const id = Date.now() + Math.random();
    setMessages(prev => [...prev, { id, message, type }]);

    setTimeout(() => {
      setMessages(prev => prev.filter(msg => msg.id !== id));
    }, 5000);
  };

  // API call function with better error handling
  const apiCall = async (endpoint, method = 'GET', data = null, timeoutMs = 10000) => {
    const controller = new AbortController();
    const timer = setTimeout(() => controller.abort(), timeoutMs);

    try {
      const options = {
        method,
        headers: {
          'Content-Type': 'application/json',
        },
        credentials: 'include',
        signal: controller.signal,
      };

      if (data && (method === 'POST' || method === 'PUT')) {
        options.body = JSON.stringify(data);
      }

      const res = await fetch(endpoint, options);
      clearTimeout(timer);

      let payload = null;
      const contentType = res.headers.get('content-type') || '';

      try {
        if (contentType.includes('application/json')) {
          payload = await res.json();
        } else {
          payload = await res.text();
        }
      } catch (parseErr) {
        payload = await res.text().catch(() => null);
      }

      if (!res.ok) {
        const bodyMsg = typeof payload === 'string' ? payload : (payload?.error || payload?.message);
        const msg = bodyMsg || `${res.status} ${res.statusText}` || `Request failed: ${res.status}`;
        const err = new Error(msg);
        err.status = res.status;
        err.payload = payload;
        throw err;
      }

      return payload;
    } catch (err) {
      clearTimeout(timer);

      if (err.name === 'AbortError') {
        showMessage('Request timed out. Please try again.', 'error');
      } else if (err instanceof TypeError) {
        console.error('Network error:', err);
        showMessage('Cannot connect to server. Please check if the backend is running.', 'error');
      } else {
        const serverMsg = err.payload?.error || err.payload?.message || err.message;
        showMessage(serverMsg || 'An error occurred. Please try again.', 'error');
      }

      throw err;
    }
  };

  // Form Handlers
  const handleLoginSubmit = async (e) => {
    e.preventDefault();

    if (!validateLoginForm()) return;

    setIsSubmitting(true);

    try {
      const result = await apiCall(API_ROUTES.LOGIN, 'POST', {
        email: loginData.email,
        password: loginData.password
      });

      const { user, token } = result || {};

      // Remember me functionality
      if (rememberMe) {
        localStorage.setItem('rememberedUser', JSON.stringify({
          email: loginData.email
        }));
        localStorage.setItem('authToken', token);
      } else {
        localStorage.removeItem('rememberedUser');
        sessionStorage.setItem('authToken', token);
      }

      setCurrentUser(user || null);
      showMessage('Login successful! Redirecting...', 'success');

      // navigate immediately; keep a short delay so user sees message
      setTimeout(() => {
        navigate('/');
      }, 800);
    } catch (error) {
      // handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleSignupSubmit = async (e) => {
    e.preventDefault();

    if (!validateSignupForm()) return;

    setIsSubmitting(true);

    try {
      const result = await apiCall(API_ROUTES.REGISTER, 'POST', {
        name: signupData.name.trim(),
        email: signupData.email,
        password: signupData.password
      });

      setPendingVerification({ email: signupData.email });
      setShowVerification(true);
      showMessage('Account created! Please check your email for verification code.', 'success');
    } catch (error) {
      // handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleVerificationSubmit = async (e) => {
    e.preventDefault();

    if (!pendingVerification?.email) {
      showMessage('No pending verification found. Please register first.', 'error');
      return;
    }

    setIsSubmitting(true);

    try {
      const verifiedEmail = pendingVerification.email;

      await apiCall(API_ROUTES.VERIFY_EMAIL, 'POST', {
        email: verifiedEmail,
        code: verificationCode
      });

      setShowVerification(false);
      setPendingVerification(null);
      setVerificationCode('');

      if (verifiedEmail) {
        setLoginData(prev => ({ ...prev, email: verifiedEmail }));
      }

      showMessage('Email verified successfully! Redirecting to login...', 'success');

      setTimeout(() => {
        setActiveForm('login');
        setTimeout(() => loginPasswordRef.current?.focus(), 200);
      }, 800);
    } catch (error) {
      // handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  const handleForgotPasswordSubmit = async (e) => {
    e.preventDefault();

    if (!forgotEmail) {
      showMessage('Please enter your email address', 'error');
      return;
    }

    if (!validateEmail(forgotEmail)) {
      showMessage('Please enter a valid email address', 'error');
      return;
    }

    setIsSubmitting(true);

    try {
      await apiCall(API_ROUTES.FORGOT_PASSWORD, 'POST', {
        email: forgotEmail
      });

      showMessage('Password reset link sent to your email!', 'success');
      setShowForgotPassword(false);
      setForgotEmail('');
    } catch (error) {
      // handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  const resendVerificationCode = async () => {
    if (!pendingVerification?.email) {
      showMessage('No email to resend code to. Please register first.', 'error');
      return;
    }

    setIsSubmitting(true);

    try {
      await apiCall(API_ROUTES.SEND_VERIFICATION, 'POST', {
        email: pendingVerification.email
      });
      showMessage('Verification code resent to your email!', 'success');
    } catch (error) {
      // handled in apiCall
    } finally {
      setIsSubmitting(false);
    }
  };

  // Render Login Form
  const renderLoginForm = () => (
    <form onSubmit={handleLoginSubmit} className="space-y-6" noValidate>
      <AuthIllustration type="login" />

      <SocialLoginButtons />

      <div className="relative flex items-center my-6">
        <div className="flex-grow border-t border-gray-300" />
        <span className="flex-shrink mx-4 text-gray-600 text-sm">Or continue with email</span>
        <div className="flex-grow border-t border-gray-300" />
      </div>

      <InputField
        id="email"
        label="Email Address"
        type="email"
        value={loginData.email}
        onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}
        placeholder="Enter your email"
        error={formErrors.email}
        required
      />

      <InputField
        id="password"
        label="Password"
        type={passwordVisible.login ? "text" : "password"}
        value={loginData.password}
        onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}
        placeholder="Enter your password"
        error={formErrors.password}
        showPasswordToggle
        onTogglePassword={() => togglePasswordVisibility('login')}
        passwordVisible={passwordVisible.login}
        ref={loginPasswordRef}
        required
      />

      <div className="flex items-center justify-between">
        <div className="flex items-center">
          <input
            type="checkbox"
            id="remember"
            className="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"
            checked={rememberMe}
            onChange={(e) => setRememberMe(e.target.checked)}
          />
          <label htmlFor="remember" className="ml-2 block text-sm text-gray-700">
            Remember me
          </label>
        </div>

        <button
          type="button"
          className="text-sm text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
          onClick={() => setShowForgotPassword(true)}
        >
          Forgot Password?
        </button>
      </div>

      <InputField
        id="captcha"
        label={`Security Check: ${captcha.question}`}
        type="number"
        value={captchaInput}
        onChange={(e) => setCaptchaInput(e.target.value)}
        placeholder="Enter the answer"
        error={formErrors.captcha}
        required
      />

      <button
        type="submit"
        disabled={isSubmitting}
        className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
      >
        {isSubmitting ? 'Signing In...' : 'Sign In'}
      </button>

      <div className="text-center mt-4">
        <p className="text-sm text-gray-600">
          Don't have an account?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={() => setActiveForm('signup')}
          >
            Sign Up
          </button>
        </p>
      </div>
    </form>
  );

  // Render Signup Form
  const renderSignupForm = () => (
    <form onSubmit={handleSignupSubmit} className="space-y-6" noValidate>
      <AuthIllustration type="signup" />

      <SocialLoginButtons />

      <div className="relative flex items-center my-6">
        <div className="flex-grow border-t border-gray-300" />
        <span className="flex-shrink mx-4 text-gray-600 text-sm">Or sign up with email</span>
        <div className="flex-grow border-t border-gray-300" />
      </div>

      <InputField
        id="name"
        label="Full Name"
        type="text"
        value={signupData.name}
        onChange={(e) => setSignupData({ ...signupData, name: e.target.value })}
        placeholder="Enter your full name"
        error={formErrors.name}
        required
      />

      <InputField
        id="signup-email"
        label="Email Address"
        type="email"
        value={signupData.email}
        onChange={(e) => setSignupData({ ...signupData, email: e.target.value })}
        placeholder="Enter your email"
        error={formErrors.email}
        required
      />

      <div>
        <div className="flex items-center justify-between mb-1">
          <label htmlFor="signup-password" className="block text-sm font-medium text-gray-700">
            Password
          </label>
          <button
            type="button"
            className="text-xs text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={generatePassword}
          >
            Generate Strong Password
          </button>
        </div>

        <InputField
          id="signup-password"
          type={passwordVisible.signup ? "text" : "password"}
          value={signupData.password}
          onChange={(e) => {
            setSignupData({ ...signupData, password: e.target.value });
            checkPasswordStrength(e.target.value);
          }}
          placeholder="Create a strong password"
          error={formErrors.password}
          showPasswordToggle
          onTogglePassword={() => togglePasswordVisibility('signup')}
          passwordVisible={passwordVisible.signup}
          required
        />

        {signupData.password && <PasswordStrength strength={passwordStrength} />}
      </div>

      <InputField
        id="confirm-password"
        label="Confirm Password"
        type={passwordVisible.confirm ? "text" : "password"}
        value={signupData.confirmPassword}
        onChange={(e) => setSignupData({ ...signupData, confirmPassword: e.target.value })}
        placeholder="Confirm your password"
        error={formErrors.confirmPassword}
        showPasswordToggle
        onTogglePassword={() => togglePasswordVisibility('confirm')}
        passwordVisible={passwordVisible.confirm}
        required
      />

      <InputField
        id="signup-captcha"
        label={`Security Check: ${captcha.question}`}
        type="number"
        value={signupCaptchaInput}
        onChange={(e) => setSignupCaptchaInput(e.target.value)}
        placeholder="Enter the answer"
        error={formErrors.captcha}
        required
      />

      <div className="flex items-start">
        <input
          type="checkbox"
          id="terms"
          className="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded mt-1"
          checked={termsAccepted}
          onChange={(e) => setTermsAccepted(e.target.checked)}
        />
        <label htmlFor="terms" className="ml-2 block text-sm text-gray-700">
          I agree to the <a href="#" className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200">Terms and Conditions</a>
        </label>
      </div>
      {formErrors.terms && <p className="text-sm text-red-600">{formErrors.terms}</p>}

      <button
        type="submit"
        disabled={isSubmitting}
        className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
      >
        {isSubmitting ? 'Creating Account...' : 'Create Account'}
      </button>

      <div className="text-center mt-4">
        <p className="text-sm text-gray-600">
          Already have an account?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={() => setActiveForm('login')}
          >
            Sign In
          </button>
        </p>
      </div>
    </form>
  );

  // Render Forgot Password Modal
  const renderForgotPasswordModal = () => (
    <Modal
      isOpen={showForgotPassword}
      onClose={() => setShowForgotPassword(false)}
      title="Reset Password"
    >
      <div className="text-center mb-4">
        <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center">
          <svg className="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
        </div>
      </div>

      <p className="text-gray-600 mb-6 text-center">
        Enter your email address and we'll send you a link to reset your password.
      </p>

      <form onSubmit={handleForgotPasswordSubmit} className="space-y-4" noValidate>
        <InputField
          id="forgot-email"
          label="Email Address"
          type="email"
          value={forgotEmail}
          onChange={(e) => setForgotEmail(e.target.value)}
          placeholder="Enter your email"
          required
        />

        <button
          type="submit"
          disabled={isSubmitting}
          className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {isSubmitting ? 'Sending...' : 'Send Reset Link'}
        </button>
      </form>
    </Modal>
  );

  // Render Verification Modal
  const renderVerificationModal = () => (
    <Modal
      isOpen={showVerification}
      onClose={() => {
        setShowVerification(false);
        setPendingVerification(null);
      }}
      title="Verify Your Email"
    >
      <div className="text-center mb-4">
        <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-100 to-teal-100 rounded-full flex items-center justify-center">
          <svg className="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
        </div>
      </div>

      <p className="text-gray-600 mb-6 text-center">
        We've sent a verification code to <strong className="text-purple-600">{pendingVerification?.email}</strong>.
        Please enter the code below to verify your email address.
      </p>

      <form onSubmit={handleVerificationSubmit} className="space-y-4" noValidate>
        <InputField
          id="verification-code"
          label="Verification Code"
          type="text"
          ref={verificationInputRef}
          value={verificationCode}
          onChange={(e) => setVerificationCode(e.target.value)}
          placeholder="Enter verification code"
          required
        />

        <button
          type="submit"
          disabled={isSubmitting}
          className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {isSubmitting ? 'Verifying...' : 'Verify Email'}
        </button>
      </form>

      <div className="text-center mt-4">
        <p className="text-sm text-gray-600">
          Didn't receive the code?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
            onClick={resendVerificationCode}
            disabled={isSubmitting}
          >
            {isSubmitting ? 'Resending...' : 'Resend Code'}
          </button>
        </p>
      </div>
    </Modal>
  );

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 p-4 relative overflow-hidden">
      {/* Background decorative elements */}
      <div className="absolute inset-0 overflow-hidden" aria-hidden="true">
        <div className="absolute -top-40 -right-40 w-80 h-80 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20" />
        <div className="absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20" />
        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20" />
      </div>

      {/* Main Container */}
      <div className="w-full max-w-md relative z-10">
        {/* Auth Form Container */}
        <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl p-8 border border-white/30">
          {/* Logo/Header */}
          <div className="text-center mb-2">
            <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-full mb-4 shadow-lg">
              <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
            <h1 className="text-3xl font-bold text-gray-800">
              {activeForm === 'login' ? 'Welcome Back' : 'MDK Service'}
            </h1>
            <p className="text-gray-600 mt-2">
              {activeForm === 'login'
                ? 'Sign in to continue to your account'
                : 'Create your account to get started'}
            </p>
          </div>

          {/* Render the appropriate form */}
          {activeForm === 'login' ? renderLoginForm() : renderSignupForm()}
        </div>

        {/* Terms notice */}
        <div className="mt-6 text-center">
          <p className="text-xs text-white/80">
            By creating an account or continuing with Google, you agree to Dora's{' '}
            <a href="#" className="underline hover:text-white transition-colors">Terms & Conditions</a>{' '}
            and{' '}
            <a href="#" className="underline hover:text-white transition-colors">Privacy Policy</a>.
          </p>
        </div>
      </div>

      {/* Modals */}
      {renderForgotPasswordModal()}
      {renderVerificationModal()}

      {/* Success/Error Messages */}
      <div className="fixed top-4 right-4 z-50 max-w-sm w-full space-y-2" aria-live="polite">
        {messages.map(msg => (
          <Message
            key={msg.id}
            message={msg.message}
            type={msg.type}
            onClose={() => setMessages(prev => prev.filter(m => m.id !== msg.id))}
          />
        ))}
      </div>
    </div>
  );
};

export default AuthForm;
