// import React, { useState, useEffect } from 'react';
// import { useNavigate, useInRouterContext } from 'react-router-dom';

// // Eye Icon Component
// const EyeIcon = ({ visible }) => (
//   visible ? (
//     <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
//       <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-5 0-9-4-9-7s4-7 9-7a9.964 9.964 0 014.031.84M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
//       <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3l18 18" />
//     </svg>
//   ) : (
//     <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
//       <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c5 0 9 4 9 7 0 1.18-.293 2.29-.805 3.286M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
//     </svg>
//   )
// );

// // Message Component
// const Message = ({ message, type, onClose }) => (
//   <div className={`p-4 mb-4 rounded-lg shadow-md flex items-center justify-between animate-slide-in ${
//     type === 'error' ? 'bg-red-100 text-red-700 border border-red-300' :
//     type === 'success' ? 'bg-green-100 text-green-700 border border-green-300' :
//     'bg-blue-100 text-blue-700 border border-blue-300'
//   }`}>
//     <div className="flex items-center">
//       <span className={`mr-3 ${
//         type === 'error' ? 'text-red-500' :
//         type === 'success' ? 'text-green-500' : 'text-blue-500'
//       }`}>
//         {type === 'error' ? '⚠️' : type === 'success' ? '✅' : 'ℹ️'}
//       </span>
//       <span className="text-sm font-medium">{message}</span>
//     </div>
//     <button
//       onClick={onClose}
//       className="ml-4 text-gray-500 hover:text-gray-700 transition-colors duration-200"
//       aria-label="Close message"
//     >
//       <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
//         <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
//       </svg>
//     </button>
//   </div>
// );

// // Modal Component
// const Modal = ({ isOpen, onClose, title, children }) => {
//   if (!isOpen) return null;

//   return (
//     <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fade-in">
//       <div className="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md animate-scale-in">
//         <div className="flex justify-between items-center mb-4">
//           <h2 className="text-2xl font-bold text-gray-800">{title}</h2>
//           <button
//             onClick={onClose}
//             className="text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded-full hover:bg-gray-100"
//             aria-label="Close modal"
//           >
//             <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
//               <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
//             </svg>
//           </button>
//         </div>
//         {children}
//       </div>
//     </div>
//   );
// };

// // Password Strength Indicator
// const PasswordStrength = ({ strength }) => {
//   const strengthLabels = ['Very Weak', 'Weak', 'Medium', 'Strong', 'Very Strong'];
//   const strengthColors = ['bg-red-500', 'bg-red-500', 'bg-yellow-500', 'bg-green-500', 'bg-green-600'];

//   return (
//     <div className="mt-2">
//       <div className="flex items-center mb-1">
//         <div className="w-full bg-gray-200 rounded-full h-2">
//           <div
//             className={`h-2 rounded-full transition-all duration-300 ${strengthColors[strength]}`}
//             style={{ width: `${(strength / 4) * 100}%` }}
//           ></div>
//         </div>
//       </div>
//       <p className="text-xs text-gray-600 font-medium">
//         {strengthLabels[strength]}
//       </p>
//     </div>
//   );
// };

// // Illustration Component for Authentication
// const AuthIllustration = ({ type }) => {
//   if (type === 'signup') {
//     return (
//       <div className="relative w-full h-48 mb-6 flex items-center justify-center">
//         <div className="absolute inset-0 bg-gradient-to-r from-purple-400/20 to-indigo-400/20 rounded-2xl"></div>
//         <div className="relative z-10 text-center">
//           <div className="w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg">
//             <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
//               <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
//             </svg>
//           </div>
//           <h3 className="text-xl font-bold text-gray-800">Join Our Community</h3>
//           <p className="text-gray-600 text-sm mt-2">Create your account and get started</p>
//         </div>
//       </div>
//     );
//   }

//   return (
//     <div className="relative w-full h-48 mb-6 flex items-center justify-center">
//       <div className="absolute inset-0 bg-gradient-to-r from-blue-400/20 to-cyan-400/20 rounded-2xl"></div>
//       <div className="relative z-10 text-center">
//         <div className="w-24 h-24 mx-auto mb-4 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-full flex items-center justify-center shadow-lg">
//           <svg className="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
//             <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
//           </svg>
//         </div>
//         <h3 className="text-xl font-bold text-gray-800">Welcome Back</h3>
//         <p className="text-gray-600 text-sm mt-2">Sign in to continue your journey</p>
//       </div>
//     </div>
//   );
// };

// // Social Login Buttons
// const SocialLoginButtons = () => (
//   <div className="space-y-3 mb-6">
//     <button className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition duration-200 shadow-sm">
//       <svg className="w-5 h-5" viewBox="0 0 24 24">
//         <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
//         <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
//         <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
//         <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
//       </svg>
//       Continue with Google
//     </button>
//   </div>
// );

// const AuthForm = () => {
//   // Navigation hook (safe): prefer react-router navigation, fall back to full-page navigation.
//   const inRouter = useInRouterContext();
//   const routerNavigate = inRouter ? useNavigate() : null;
  
//   const safeNavigate = (path, options) => {
//     if (routerNavigate) {
//       routerNavigate(path, options);
//     } else {
//       // Fallback: full page navigation so clicking "Login" still works when app isn't wrapped in Router
//       window.location.href = path;
//     }
//   };

//   // State management
//   const [currentUser, setCurrentUser] = useState(null);
//   const [activeForm, setActiveForm] = useState('signup');
//   const [showForgotPassword, setShowForgotPassword] = useState(false);
//   const [showVerification, setShowVerification] = useState(false);
//   const [messages, setMessages] = useState([]);
//   const [pendingVerification, setPendingVerification] = useState(null);
  
//   // Form data states
//   const [loginData, setLoginData] = useState({ email: '', password: '' });
//   const [signupData, setSignupData] = useState({
//     name: '', email: '', password: '', confirmPassword: ''
//   });
//   const [forgotEmail, setForgotEmail] = useState('');
//   const [verificationCode, setVerificationCode] = useState('');
//   const [rememberMe, setRememberMe] = useState(false);
//   const [termsAccepted, setTermsAccepted] = useState(false);
  
//   // Captcha state
//   const [captcha, setCaptcha] = useState({ question: '', answer: 0 });
//   const [captchaInput, setCaptchaInput] = useState('');
//   const [signupCaptchaInput, setSignupCaptchaInput] = useState('');
  
//   // Password strength
//   const [passwordStrength, setPasswordStrength] = useState(0);
  
//   // Password visibility
//   const [passwordVisible, setPasswordVisible] = useState({
//     login: false,
//     signup: false,
//     confirm: false
//   });

//   // API configuration
//   // Allow overriding API base via env (useful for different dev/prod setups)
//   const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:5000/api';
//   const SERVER_ORIGIN = (() => {
//     try {
//       return new URL(API_BASE_URL).origin;
//     } catch (e) {
//       return window.location.origin;
//     }
//   })();
//   const HEALTH_ENDPOINT = `${SERVER_ORIGIN}/health`;

//   // Generate Captcha
//   const generateCaptcha = () => {
//     const num1 = Math.floor(Math.random() * 10) + 1;
//     const num2 = Math.floor(Math.random() * 10) + 1;
//     return {
//       question: `${num1} + ${num2} = ?`,
//       answer: num1 + num2
//     };
//   };

//   // Initialize component
//   useEffect(() => {
//     setCaptcha(generateCaptcha());

//     // Check for remembered user
//     try {
//       const rememberedUser = JSON.parse(localStorage.getItem('rememberedUser') || 'null');
//       if (rememberedUser) {
//         setLoginData({
//           email: rememberedUser.email,
//           password: rememberedUser.password || ''
//         });
//         setRememberMe(true);
//       }
//     } catch (e) {
//       // Ignore parse errors
//       console.warn('Error parsing remembered user:', e);
//     }
//   }, []);

//   // Reset forms when switching between login/signup
//   useEffect(() => {
//     setCaptcha(generateCaptcha());
//     setCaptchaInput('');
//     setSignupCaptchaInput('');
//   }, [activeForm]);

//   // Toggle Password Visibility
//   const togglePasswordVisibility = (field) => {
//     setPasswordVisible(prev => ({
//       ...prev,
//       [field]: !prev[field]
//     }));
//   };

//   // Check Password Strength
//   const checkPasswordStrength = (password) => {
//     let strength = 0;

//     if (password.length >= 8) strength++;
//     if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
//     if (password.match(/[0-9]/)) strength++;
//     if (password.match(/[^a-zA-Z0-9]/)) strength++;

//     setPasswordStrength(strength);
//     return strength;
//   };

//   // Generate Strong Password
//   const generatePassword = () => {
//     const lowercase = 'abcdefghijklmnopqrstuvwxyz';
//     const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
//     const numbers = '0123456789';
//     const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';

//     let password = '';
//     password += lowercase[Math.floor(Math.random() * lowercase.length)];
//     password += uppercase[Math.floor(Math.random() * uppercase.length)];
//     password += numbers[Math.floor(Math.random() * numbers.length)];
//     password += symbols[Math.floor(Math.random() * symbols.length)];

//     const allChars = lowercase + uppercase + numbers + symbols;
//     for (let i = 4; i < 12; i++) {
//       password += allChars[Math.floor(Math.random() * allChars.length)];
//     }

//     password = password.split('').sort(() => Math.random() - 0.5).join('');

//     setSignupData(prev => ({
//       ...prev,
//       password,
//       confirmPassword: password
//     }));

//     checkPasswordStrength(password);
//     showMessage('Strong password generated!', 'success');
//   };

//   // Show Message
//   const showMessage = (message, type = 'info') => {
//     const id = Date.now();
//     setMessages(prev => [...prev, { id, message, type }]);

//     setTimeout(() => {
//       setMessages(prev => prev.filter(msg => msg.id !== id));
//     }, 5000);
//   };

//   // API call function
//   const apiCall = async (endpoint, method = 'GET', data = null, timeoutMs = 8000) => {
//     const controller = new AbortController();
//     const timer = setTimeout(() => controller.abort(), timeoutMs);

//     try {
//       const options = {
//         method,
//         headers: { 'Content-Type': 'application/json' },
//         credentials: 'include', // include cookies for session-based auth
//         signal: controller.signal,
//       };
//       if (data && (method === 'POST' || method === 'PUT')) {
//         options.body = JSON.stringify(data);
//       }

//       const res = await fetch(`${API_BASE_URL}${endpoint}`, options);
//       clearTimeout(timer);

//       // Safely parse response
//       let payload = null;
//       const contentType = res.headers.get('content-type') || '';
//       try {
//         if (contentType.includes('application/json')) {
//           payload = await res.json();
//         } else {
//           payload = await res.text();
//         }
//       } catch (parseErr) {
//         try { payload = await res.text(); } catch (e) { payload = null; }
//       }

//       if (!res.ok) {
//         const bodyMsg = typeof payload === 'string' ? payload : (payload?.error || payload?.message);
//         const msg = bodyMsg || `${res.status} ${res.statusText}` || `Request failed: ${res.status}`;
//         const err = new Error(msg);
//         err.status = res.status;
//         err.payload = payload;
//         console.error('API Error:', res.status, msg, payload);
//         throw err;
//       }

//       return payload;
//     } catch (err) {
//       clearTimeout(timer);
//       console.error('API call error:', err);

//       if (err.name === 'AbortError') {
//         showMessage('Request timed out. Backend may be slow or unreachable.', 'error');
//       } else if (err instanceof TypeError) {
//         // Likely a network or CORS error. Perform health check with a fresh controller.
//         try {
//           const healthController = new AbortController();
//           const healthTimer = setTimeout(() => healthController.abort(), 3000);
//           const healthRes = await fetch(HEALTH_ENDPOINT, { method: 'GET', signal: healthController.signal });
//           clearTimeout(healthTimer);
//           if (healthRes.ok) {
//             // Server reachable but original request failed -> likely CORS or incorrect API path
//             showMessage('Network/CORS error while calling API. Check backend CORS settings and API_BASE_URL.', 'error');
//           } else {
//             showMessage('Backend health check failed. Check server logs.', 'error');
//           }
//         } catch (healthErr) {
//           // Health check failed => server likely down or wrong origin
//           showMessage('Cannot reach backend. Is the server running?', 'error');
//         }
//       } else {
//         const serverMsg = err.payload && typeof err.payload === 'string'
//           ? err.payload
//           : (err.payload && typeof err.payload === 'object' ? (err.payload.error || err.payload.message) : err.message);
//         showMessage(`Server error (${err.status || 'error'}): ${serverMsg || err.message}`, 'error');
//       }

//       throw err;
//     }
//   };

//   // Form Handlers
//   const handleLoginSubmit = async (e) => {
//     e.preventDefault();
    
//     // Check captcha
//     if (parseInt(captchaInput, 10) !== captcha.answer) {
//       showMessage('Incorrect captcha answer!', 'error');
//       setCaptcha(generateCaptcha());
//       setCaptchaInput('');
//       return;
//     }

//     try {
//       const result = await apiCall('/auth/login', 'POST', {
//         email: loginData.email,
//         password: loginData.password
//       });

//       const { user, token } = result;
      
//       // Remember me functionality
//       if (rememberMe) {
//         localStorage.setItem('rememberedUser', JSON.stringify({
//           email: loginData.email
//         }));
//         localStorage.setItem('authToken', token);
//       } else {
//         localStorage.removeItem('rememberedUser');
//         sessionStorage.setItem('authToken', token);
//       }

//       setCurrentUser(user);
//       showMessage('Login successful! Redirecting to home page...', 'success');

//       // Redirect to home page after successful login
//       setTimeout(() => {
//         safeNavigate('/');
//       }, 1500);
//     } catch (error) {
//       // Error handled in apiCall
//     }
//   };

//   const handleSignupSubmit = async (e) => {
//     e.preventDefault();
    
//     // Check captcha
//     if (parseInt(signupCaptchaInput, 10) !== captcha.answer) {
//       showMessage('Incorrect captcha answer!', 'error');
//       setCaptcha(generateCaptcha());
//       setSignupCaptchaInput('');
//       return;
//     }

//     if (signupData.password !== signupData.confirmPassword) {
//       showMessage('Passwords do not match!', 'error');
//       return;
//     }

//     if (checkPasswordStrength(signupData.password) < 3) {
//       showMessage('Password is too weak! Please use a stronger password.', 'error');
//       return;
//     }

//     if (!termsAccepted) {
//       showMessage('Please accept the terms and conditions', 'error');
//       return;
//     }

//     try {
//       const result = await apiCall('/auth/register', 'POST', {
//         name: signupData.name,
//         email: signupData.email,
//         password: signupData.password
//       });

//       // move to verification step immediately
//       setPendingVerification({ email: signupData.email });
//       setShowVerification(true);

//       // Note: do NOT change activeForm here. keep the main form rendering as-is
//       // and show verification via the modal (showVerification). Changing
//       // activeForm to an unsupported value caused the login/signup UI to disappear.

//       showMessage('Account created! Please check your email for verification code.', 'success');
//     } catch (error) {
//       // Error handled in apiCall
//     }
//   };

//   const handleVerificationSubmit = async (e) => {
//     e.preventDefault();

//     if (!pendingVerification?.email) {
//       showMessage('No pending verification found. Please register or request a code first.', 'error');
//       return;
//     }

//     const emailToVerify = pendingVerification.email;

//     try {
//       await apiCall('/auth/verify-email', 'POST', {
//         email: emailToVerify,
//         code: verificationCode
//       });

//       setShowVerification(false);
//       setPendingVerification(null);
//       setVerificationCode('');
//       showMessage('Email verified successfully! Redirecting to login...', 'success');

//       // Redirect to the login form/route so user can sign in
//       setTimeout(() => {
//         safeNavigate('/login');
//       }, 1200);
//     } catch (error) {
//       // Error handled in apiCall
//     }
//   };

//   const handleForgotPasswordSubmit = async (e) => {
//     e.preventDefault();

//     try {
//       await apiCall('/auth/forgot-password', 'POST', {
//         email: forgotEmail
//       });

//       showMessage('Password reset link sent to your email!', 'success');
//       setShowForgotPassword(false);
//       setForgotEmail('');
//     } catch (error) {
//       // Error handled in apiCall
//     }
//   };

//   const resendVerificationCode = async () => {
//     if (!pendingVerification?.email) {
//       showMessage('No email to resend code to. Please register first.', 'error');
//       return;
//     }
//     try {
//       await apiCall('/auth/send-verification', 'POST', { 
//         email: pendingVerification.email 
//       });
//       showMessage('Verification code resent to your email!', 'success');
//     } catch (error) {
//       // Error handled in apiCall
//     }
//   };

//   // Render Login Form
//   const renderLoginForm = () => (
//     <form onSubmit={handleLoginSubmit} className="space-y-6">
//       <AuthIllustration type="login" />
      
//       <SocialLoginButtons />
      
//       <div className="relative flex items-center my-6">
//         <div className="flex-grow border-t border-gray-300"></div>
//         <span className="flex-shrink mx-4 text-gray-600 text-sm">Or continue with email</span>
//         <div className="flex-grow border-t border-gray-300"></div>
//       </div>

//       <div>
//         <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
//           Email Address
//         </label>
//         <input
//           type="email"
//           id="email"
//           className="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
//           placeholder="Enter your email"
//           value={loginData.email}
//           onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}
//           required
//         />
//       </div>

//       <div>
//         <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
//           Password
//         </label>
//         <div className="relative">
//           <input
//             type={passwordVisible.login ? "text" : "password"}
//             id="password"
//             className="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 pr-12"
//             placeholder="Enter your password"
//             value={loginData.password}
//             onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}
//             required
//           />
//           <button
//             type="button"
//             className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded"
//             onClick={() => togglePasswordVisibility('login')}
//             aria-label={passwordVisible.login ? "Hide password" : "Show password"}
//           >
//             <EyeIcon visible={passwordVisible.login} />
//           </button>
//         </div>
//       </div>

//       <div className="flex items-center justify-between">
//         <div className="flex items-center">
//           <input
//             type="checkbox"
//             id="remember"
//             className="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"
//             checked={rememberMe}
//             onChange={(e) => setRememberMe(e.target.checked)}
//           />
//           <label htmlFor="remember" className="ml-2 block text-sm text-gray-700">
//             Remember me
//           </label>
//         </div>

//         <button
//           type="button"
//           className="text-sm text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
//           onClick={() => setShowForgotPassword(true)}
//         >
//           Forgot Password?
//         </button>
//       </div>

//       <div>
//         <label htmlFor="captcha" className="block text-sm font-medium text-gray-700 mb-1">
//           Security Check: {captcha.question}
//         </label>
//         <input
//           type="number"
//           id="captcha"
//           className="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
//           placeholder="Enter the answer"
//           value={captchaInput}
//           onChange={(e) => setCaptchaInput(e.target.value)}
//           required
//         />
//       </div>

//       <button
//         type="submit"
//         className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
//       >
//         Sign In
//       </button>

//       <div className="text-center mt-4">
//         <p className="text-sm text-gray-600">
//           Don't have an account?{' '}
//           <button
//             type="button"
//             className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
//             onClick={() => setActiveForm('signup')}
//           >
//             Sign Up
//           </button>
//         </p>
//       </div>
//     </form>
//   );

//   // Render Signup Form
//   const renderSignupForm = () => (
//     <form onSubmit={handleSignupSubmit} className="space-y-6">
//       <AuthIllustration type="signup" />
      
//       <SocialLoginButtons />
      
//       <div className="relative flex items-center my-6">
//         <div className="flex-grow border-t border-gray-300"></div>
//         <span className="flex-shrink mx-4 text-gray-600 text-sm">Or sign up with email</span>
//         <div className="flex-grow border-t border-gray-300"></div>
//       </div>

//       <div>
//         <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1">
//           Full Name
//         </label>
//         <input
//           type="text"
//           id="name"
//           className="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
//           placeholder="Enter your full name"
//           value={signupData.name}
//           onChange={(e) => setSignupData({ ...signupData, name: e.target.value })}
//           required
//         />
//       </div>

//       <div>
//         <label htmlFor="signup-email" className="block text-sm font-medium text-gray-700 mb-1">
//           Email Address
//         </label>
//         <input
//           type="email"
//           id="signup-email"
//           className="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
//           placeholder="Enter your email"
//           value={signupData.email}
//           onChange={(e) => setSignupData({ ...signupData, email: e.target.value })}
//           required
//         />
//       </div>

//       <div>
//         <label htmlFor="signup-password" className="block text-sm font-medium text-gray-700 mb-1">
//           Password
//           <button
//             type="button"
//             className="ml-2 text-xs text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
//             onClick={generatePassword}
//           >
//             Generate Strong Password
//           </button>
//         </label>
//         <div className="relative">
//           <input
//             type={passwordVisible.signup ? "text" : "password"}
//             id="signup-password"
//             className="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 pr-12"
//             placeholder="Create a strong password"
//             value={signupData.password}
//             onChange={(e) => {
//               setSignupData({ ...signupData, password: e.target.value });
//               checkPasswordStrength(e.target.value);
//             }}
//             required
//           />
//           <button
//             type="button"
//             className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded"
//             onClick={() => togglePasswordVisibility('signup')}
//             aria-label={passwordVisible.signup ? "Hide password" : "Show password"}
//           >
//             <EyeIcon visible={passwordVisible.signup} />
//           </button>
//         </div>

//         {signupData.password && (
//           <PasswordStrength strength={passwordStrength} />
//         )}
//       </div>

//       <div>
//         <label htmlFor="confirm-password" className="block text-sm font-medium text-gray-700 mb-1">
//           Confirm Password
//         </label>
//         <div className="relative">
//           <input
//             type={passwordVisible.confirm ? "text" : "password"}
//             id="confirm-password"
//             className="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 pr-12"
//             placeholder="Confirm your password"
//             value={signupData.confirmPassword}
//             onChange={(e) => setSignupData({ ...signupData, confirmPassword: e.target.value })}
//             required
//           />
//           <button
//             type="button"
//             className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded"
//             onClick={() => togglePasswordVisibility('confirm')}
//             aria-label={passwordVisible.confirm ? "Hide password" : "Show password"}
//           >
//             <EyeIcon visible={passwordVisible.confirm} />
//           </button>
//         </div>
//       </div>

//       <div>
//         <label htmlFor="signup-captcha" className="block text-sm font-medium text-gray-700 mb-1">
//           Security Check: {captcha.question}
//         </label>
//         <input
//           type="number"
//           id="signup-captcha"
//           className="w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
//           placeholder="Enter the answer"
//           value={signupCaptchaInput}
//           onChange={(e) => setSignupCaptchaInput(e.target.value)}
//           required
//         />
//       </div>

//       <div className="flex items-start">
//         <input
//           type="checkbox"
//           id="terms"
//           className="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded mt-1"
//           checked={termsAccepted}
//           onChange={(e) => setTermsAccepted(e.target.checked)}
//           required
//         />
//         <label htmlFor="terms" className="ml-2 block text-sm text-gray-700">
//           I agree to the <a href="#" className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200">Terms and Conditions</a>
//         </label>
//       </div>

//       <button
//         type="submit"
//         className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5"
//       >
//         Create Account
//       </button>

//       <div className="text-center mt-4">
//         <p className="text-sm text-gray-600">
//           Already have an account?{' '}
//           <button
//             type="button"
//             className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
//             onClick={() => setActiveForm('login')}
//           >
//             Sign In
//           </button>
//         </p>
//       </div>
//     </form>
//   );

//   // Render Forgot Password Modal
//   const renderForgotPasswordModal = () => (
//     <Modal
//       isOpen={showForgotPassword}
//       onClose={() => setShowForgotPassword(false)}
//       title="Reset Password"
//     >
//       <div className="text-center mb-4">
//         <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center">
//           <svg className="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
//             <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
//           </svg>
//         </div>
//       </div>
      
//       <p className="text-gray-600 mb-6 text-center">
//         Enter your email address and we'll send you a link to reset your password.
//       </p>

//       <form onSubmit={handleForgotPasswordSubmit} className="space-y-4">
//         <div>
//           <label htmlFor="forgot-email" className="block text-sm font-medium text-gray-700 mb-1">
//             Email Address
//           </label>
//           <input
//             type="email"
//             id="forgot-email"
//             className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
//             placeholder="Enter your email"
//             value={forgotEmail}
//             onChange={(e) => setForgotEmail(e.target.value)}
//             required
//           />
//         </div>

//         <button
//           type="submit"
//           className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg"
//         >
//           Send Reset Link
//         </button>
//       </form>
//     </Modal>
//   );

//   // Render Verification Modal
//   const renderVerificationModal = () => (
//     <Modal
//       isOpen={showVerification}
//       onClose={() => {
//         setShowVerification(false);
//         setPendingVerification(null);
//       }}
//       title="Verify Your Email"
//     >
//       <div className="text-center mb-4">
//         <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-100 to-teal-100 rounded-full flex items-center justify-center">
//           <svg className="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
//             <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
//           </svg>
//         </div>
//       </div>
      
//       <p className="text-gray-600 mb-6 text-center">
//         We've sent a verification code to <strong className="text-purple-600">{pendingVerification?.email}</strong>.
//         Please enter the code below to verify your email address.
//       </p>

//       <form onSubmit={handleVerificationSubmit} className="space-y-4">
//         <div>
//           <label htmlFor="verification-code" className="block text-sm font-medium text-gray-700 mb-1">
//             Verification Code
//           </label>
//           <input
//             type="text"
//             id="verification-code"
//             className="w-full px-4 py-3 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 text-center text-lg font-mono tracking-widest"
//             placeholder="Enter verification code"
//             value={verificationCode}
//             onChange={(e) => setVerificationCode(e.target.value)}
//             required
//           />
//         </div>

//         <button
//           type="submit"
//           className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg"
//         >
//           Verify Email
//         </button>
//       </form>

//       <div className="text-center mt-4">
//         <p className="text-sm text-gray-600">
//           Didn't receive the code?{' '}
//           <button
//             type="button"
//             className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
//             onClick={resendVerificationCode}
//           >
//             Resend Code
//           </button>
//         </p>
//       </div>
//     </Modal>
//   );

//   return (
//     <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 p-4 relative overflow-hidden">
//       {/* Background decorative elements */}
//       <div className="absolute inset-0 overflow-hidden">
//         <div className="absolute -top-40 -right-40 w-80 h-80 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
//         <div className="absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse animation-delay-2000"></div>
//         <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse animation-delay-4000"></div>
//       </div>

//       {/* Main Container */}
//       <div className="w-full max-w-md relative z-10">
//         {/* Auth Form Container */}
//         <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl p-8 animate-fade-in border border-white/30">
//           {/* Logo/Header */}
//           <div className="text-center mb-2">
//             <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-full mb-4 shadow-lg">
//               <svg className="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
//                 <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
//               </svg>
//             </div>
//             <h1 className="text-3xl font-bold text-gray-800">
//               {activeForm === 'login' ? 'Welcome Back' : 'Join Dora'}
//             </h1>
//             <p className="text-gray-600 mt-2">
//               {activeForm === 'login'
//                 ? 'Sign in to continue to your account'
//                 : 'Create your account to get started'}
//             </p>
//           </div>

//           {/* Render the appropriate form */}
//           {activeForm === 'login' ? renderLoginForm() : renderSignupForm()}
//         </div>

//         {/* Terms notice */}
//         <div className="mt-6 text-center">
//           <p className="text-xs text-white/80">
//             By creating an account or continuing with Google, you agree to Dora's{' '}
//             <a href="#" className="underline hover:text-white transition-colors">Terms & Conditions</a>{' '}
//             and{' '}
//             <a href="#" className="underline hover:text-white transition-colors">Privacy Policy</a>.
//           </p>
//         </div>
//       </div>

//       {/* Modals */}
//       {renderForgotPasswordModal()}
//       {renderVerificationModal()}

//       {/* Success/Error Messages */}
//       <div className="fixed top-4 right-4 z-50 max-w-sm w-full space-y-2">
//         {messages.map(msg => (
//           <Message
//             key={msg.id}
//             message={msg.message}
//             type={msg.type}
//             onClose={() => setMessages(prev => prev.filter(m => m.id !== msg.id))}
//           />
//         ))}
//       </div>
//     </div>
//   );
// };

// export default AuthForm;




import React, { useState, useEffect } from 'react';

// Eye Icon Component
const EyeIcon = ({ visible }) => (
  visible ? (
    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-5 0-9-4-9-7s4-7 9-7a9.964 9.964 0 014.031.84M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 3l18 18" />
    </svg>
  ) : (
    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c5 0 9 4 9 7 0 1.18-.293 2.29-.805 3.286M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
    </svg>
  )
);

// Message Component
const Message = ({ message, type, onClose }) => (
  <div className={`p-4 mb-4 rounded-lg shadow-md flex items-center justify-between animate-slide-in ${
    type === 'error' ? 'bg-red-100 text-red-700 border border-red-300' :
    type === 'success' ? 'bg-green-100 text-green-700 border border-green-300' :
    'bg-blue-100 text-blue-700 border border-blue-300'
  }`}>
    <div className="flex items-center">
      <span className={`mr-3 ${
        type === 'error' ? 'text-red-500' :
        type === 'success' ? 'text-green-500' : 'text-blue-500'
      }`}>
        {type === 'error' ? '⚠️' : type === 'success' ? '✅' : 'ℹ️'}
      </span>
      <span className="text-sm font-medium">{message}</span>
    </div>
    <button
      onClick={onClose}
      className="ml-4 text-gray-500 hover:text-gray-700 transition-colors duration-200"
      aria-label="Close message"
    >
      <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>
);

// Modal Component
const Modal = ({ isOpen, onClose, title, children }) => {
  useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = 'hidden';
    } else {
      document.body.style.overflow = 'unset';
    }

    return () => {
      document.body.style.overflow = 'unset';
    };
  }, [isOpen]);

  if (!isOpen) return null;

  return (
    <div 
      className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fade-in"
      onClick={onClose}
    >
      <div 
        className="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md animate-scale-in"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-2xl font-bold text-gray-800">{title}</h2>
          <button
            onClick={onClose}
            className="text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded-full hover:bg-gray-100"
            aria-label="Close modal"
          >
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        {children}
      </div>
    </div>
  );
};

// Password Strength Indicator
const PasswordStrength = ({ strength }) => {
  const strengthLabels = ['Very Weak', 'Weak', 'Medium', 'Strong', 'Very Strong'];
  const strengthColors = ['bg-red-500', 'bg-orange-500', 'bg-yellow-500', 'bg-green-500', 'bg-green-600'];
  const widthPercent = Math.max(20, (strength / 4) * 100);

  return (
    <div className="mt-2">
      <div className="flex items-center mb-1">
        <div className="w-full bg-gray-200 rounded-full h-2">
          <div
            className={`h-2 rounded-full transition-all duration-300 ${strengthColors[strength]}`}
            style={{ width: `${widthPercent}%` }}
          ></div>
        </div>
      </div>
      <p className="text-xs text-gray-600 font-medium">
        {strengthLabels[strength]}
      </p>
    </div>
  );
};

// Illustration Component for Authentication
const AuthIllustration = ({ type }) => {
  if (type === 'signup') {
    return (
      <div className="relative w-full h-40 mb-6 flex items-center justify-center">
        <div className="absolute inset-0 bg-gradient-to-r from-purple-400/20 to-indigo-400/20 rounded-2xl"></div>
        <div className="relative z-10 text-center">
          <div className="w-20 h-20 mx-auto mb-3 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg">
            <svg className="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <h3 className="text-lg font-bold text-gray-800">Join Our Community</h3>
          <p className="text-gray-600 text-xs mt-1">Create your account and get started</p>
        </div>
      </div>
    );
  }

  return (
    <div className="relative w-full h-40 mb-6 flex items-center justify-center">
      <div className="absolute inset-0 bg-gradient-to-r from-blue-400/20 to-cyan-400/20 rounded-2xl"></div>
      <div className="relative z-10 text-center">
        <div className="w-20 h-20 mx-auto mb-3 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-full flex items-center justify-center shadow-lg">
          <svg className="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
        </div>
        <h3 className="text-lg font-bold text-gray-800">Welcome Back</h3>
        <p className="text-gray-600 text-xs mt-1">Sign in to continue your journey</p>
      </div>
    </div>
  );
};

// Social Login Buttons
const SocialLoginButtons = () => (
  <div className="space-y-3 mb-4">
    <button 
      type="button"
      className="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 text-gray-700 py-2.5 px-4 rounded-lg font-medium hover:bg-gray-50 transition duration-200 shadow-sm active:scale-95"
    >
      <svg className="w-4 h-4" viewBox="0 0 24 24">
        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
      </svg>
      Continue with Google
    </button>
  </div>
);

const AuthForm = () => {
  // Navigation: avoid using react-router hooks directly (they throw if no Router present).
  // Use history.pushState + dispatch popstate so SPA routers can handle it when present,
  // and fall back to window.location.href as a last resort.
  const safeNavigate = (path) => {
    if (typeof window === 'undefined') return;

    try {
      // Try SPA-like navigation first
      window.history.pushState({}, '', path);
      // Some routers listen for popstate to update; dispatch to inform them
      window.dispatchEvent(new PopStateEvent('popstate'));
    } catch (e) {
      // If anything goes wrong, do a full navigation
      window.location.href = path;
    }
  };

  // State management
  const [currentUser, setCurrentUser] = useState(null);
  const [activeForm, setActiveForm] = useState('signup');
  const [showForgotPassword, setShowForgotPassword] = useState(false);
  const [showVerification, setShowVerification] = useState(false);
  const [messages, setMessages] = useState([]);
  const [pendingVerification, setPendingVerification] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  
  // Form data states
  const [loginData, setLoginData] = useState({ email: '', password: '' });
  const [signupData, setSignupData] = useState({
    name: '', email: '', password: '', confirmPassword: ''
  });
  const [forgotEmail, setForgotEmail] = useState('');
  const [verificationCode, setVerificationCode] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [termsAccepted, setTermsAccepted] = useState(false);
  
  // Captcha state
  const [captcha, setCaptcha] = useState({ question: '', answer: 0 });
  const [captchaInput, setCaptchaInput] = useState('');
  const [signupCaptchaInput, setSignupCaptchaInput] = useState('');
  
  // Password strength
  const [passwordStrength, setPasswordStrength] = useState(0);
  
  // Password visibility
  const [passwordVisible, setPasswordVisible] = useState({
    login: false,
    signup: false,
    confirm: false
  });

  // API configuration
  // Allow overriding API base via env (useful for different dev/prod setups)
  const API_BASE_URL = process.env.REACT_APP_API_BASE_URL || 'http://localhost:5000/api';
  const SERVER_ORIGIN = (() => {
    try {
      return new URL(API_BASE_URL).origin;
    } catch (e) {
      return window.location.origin;
    }
  })();
  const HEALTH_ENDPOINT = `${SERVER_ORIGIN}/health`;

  // Generate Captcha
  const generateCaptcha = () => {
    const num1 = Math.floor(Math.random() * 10) + 1;
    const num2 = Math.floor(Math.random() * 10) + 1;
    return {
      question: `${num1} + ${num2} = ?`,
      answer: num1 + num2
    };
  };

  // Initialize component
  useEffect(() => {
    setCaptcha(generateCaptcha());

    // Check for remembered user
    try {
      const rememberedUser = JSON.parse(localStorage.getItem('rememberedUser') || 'null');
      if (rememberedUser) {
        setLoginData({
          email: rememberedUser.email,
          password: rememberedUser.password || ''
        });
        setRememberMe(true);
      }
    } catch (e) {
      // Ignore parse errors
      console.warn('Error parsing remembered user:', e);
    }
  }, []);

  // Reset forms when switching between login/signup
  useEffect(() => {
    setCaptcha(generateCaptcha());
    setCaptchaInput('');
    setSignupCaptchaInput('');
  }, [activeForm]);

  // Toggle Password Visibility
  const togglePasswordVisibility = (field) => {
    setPasswordVisible(prev => ({
      ...prev,
      [field]: !prev[field]
    }));
  };

  // Check Password Strength
  const checkPasswordStrength = (password) => {
    let strength = 0;

    if (password.length >= 8) strength++;
    if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
    if (password.match(/[0-9]/)) strength++;
    if (password.match(/[^a-zA-Z0-9]/)) strength++;

    setPasswordStrength(strength);
    return strength;
  };

  // Generate Strong Password
  const generatePassword = () => {
    const lowercase = 'abcdefghijklmnopqrstuvwxyz';
    const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    const numbers = '0123456789';
    const symbols = '!@#$%^&*()_+-=[]{}|;:,.<>?';

    let password = '';
    password += lowercase[Math.floor(Math.random() * lowercase.length)];
    password += uppercase[Math.floor(Math.random() * uppercase.length)];
    password += numbers[Math.floor(Math.random() * numbers.length)];
    password += symbols[Math.floor(Math.random() * symbols.length)];

    const allChars = lowercase + uppercase + numbers + symbols;
    for (let i = 4; i < 12; i++) {
      password += allChars[Math.floor(Math.random() * allChars.length)];
    }

    password = password.split('').sort(() => Math.random() - 0.5).join('');

    setSignupData(prev => ({
      ...prev,
      password,
      confirmPassword: password
    }));

    checkPasswordStrength(password);
    showMessage('Strong password generated!', 'success');
  };

  // Show Message
  const showMessage = (message, type = 'info') => {
    const id = Date.now();
    setMessages(prev => [...prev, { id, message, type }]);

    setTimeout(() => {
      setMessages(prev => prev.filter(msg => msg.id !== id));
    }, 5000);
  };

  // API call function
  const apiCall = async (endpoint, method = 'GET', data = null, timeoutMs = 8000) => {
    const controller = new AbortController();
    const timer = setTimeout(() => controller.abort(), timeoutMs);

    try {
      const options = {
        method,
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        signal: controller.signal,
      };
      if (data && (method === 'POST' || method === 'PUT')) {
        options.body = JSON.stringify(data);
      }

      const res = await fetch(`${API_BASE_URL}${endpoint}`, options);
      clearTimeout(timer);

      let payload = null;
      const contentType = res.headers.get('content-type') || '';
      try {
        if (contentType.includes('application/json')) {
          payload = await res.json();
        } else {
          payload = await res.text();
        }
      } catch (parseErr) {
        try { payload = await res.text(); } catch (e) { payload = null; }
      }

      if (!res.ok) {
        const bodyMsg = typeof payload === 'string' ? payload : (payload?.error || payload?.message);
        const msg = bodyMsg || `${res.status} ${res.statusText}` || `Request failed: ${res.status}`;
        const err = new Error(msg);
        err.status = res.status;
        err.payload = payload;
        console.error('API Error:', res.status, msg, payload);
        throw err;
      }

      return payload;
    } catch (err) {
      clearTimeout(timer);
      console.error('API call error:', err);

      if (err.name === 'AbortError') {
        showMessage('Request timed out. Backend may be slow or unreachable.', 'error');
      } else if (err instanceof TypeError) {
        // Likely a network or CORS error. Perform health check with a fresh controller.
        try {
          const healthController = new AbortController();
          const healthTimer = setTimeout(() => healthController.abort(), 3000);
          const healthRes = await fetch(HEALTH_ENDPOINT, { method: 'GET', signal: healthController.signal });
          clearTimeout(healthTimer);
          if (healthRes.ok) {
            // Server reachable but original request failed -> likely CORS or incorrect API path
            showMessage('Network/CORS error while calling API. Check backend CORS settings and API_BASE_URL.', 'error');
          } else {
            showMessage('Backend health check failed. Check server logs.', 'error');
          }
        } catch (healthErr) {
          // Health check failed => server likely down or wrong origin
          showMessage('Cannot reach backend. Is the server running?', 'error');
        }
      } else {
        const serverMsg = err.payload && typeof err.payload === 'string'
          ? err.payload
          : (err.payload && typeof err.payload === 'object' ? (err.payload.error || err.payload.message) : err.message);
        showMessage(`Server error (${err.status || 'error'}): ${serverMsg || err.message}`, 'error');
      }

      throw err;
    }
  };

  // Form Handlers
  const handleLoginSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);
    
    // Check captcha
    if (parseInt(captchaInput, 10) !== captcha.answer) {
      showMessage('Incorrect captcha answer!', 'error');
      setCaptcha(generateCaptcha());
      setCaptchaInput('');
      setIsLoading(false);
      return;
    }

    try {
      const result = await apiCall('/auth/login', 'POST', {
        email: loginData.email,
        password: loginData.password
      });

      const { user, token } = result;
      
      // Remember me functionality
      if (rememberMe) {
        localStorage.setItem('rememberedUser', JSON.stringify({
          email: loginData.email
        }));
        localStorage.setItem('authToken', token);
      } else {
        localStorage.removeItem('rememberedUser');
        sessionStorage.setItem('authToken', token);
      }

      setCurrentUser(user);
      showMessage('Login successful! Redirecting to home page...', 'success');

      // Redirect to home page after successful login
      setTimeout(() => {
        safeNavigate('/');
      }, 1500);
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsLoading(false);
    }
  };

  const handleSignupSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);
    
    // Check captcha
    if (parseInt(signupCaptchaInput, 10) !== captcha.answer) {
      showMessage('Incorrect captcha answer!', 'error');
      setCaptcha(generateCaptcha());
      setSignupCaptchaInput('');
      setIsLoading(false);
      return;
    }

    if (signupData.password !== signupData.confirmPassword) {
      showMessage('Passwords do not match!', 'error');
      setIsLoading(false);
      return;
    }

    if (checkPasswordStrength(signupData.password) < 3) {
      showMessage('Password is too weak! Please use a stronger password.', 'error');
      setIsLoading(false);
      return;
    }

    if (!termsAccepted) {
      showMessage('Please accept the terms and conditions', 'error');
      setIsLoading(false);
      return;
    }

    try {
      const result = await apiCall('/auth/register', 'POST', {
        name: signupData.name,
        email: signupData.email,
        password: signupData.password
      });

      setPendingVerification({ email: signupData.email });
      setShowVerification(true);
      showMessage('Account created! Please check your email for verification code.', 'success');
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsLoading(false);
    }
  };

  const handleVerificationSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);

    if (!pendingVerification?.email) {
      showMessage('No pending verification found. Please register or request a code first.', 'error');
      setIsLoading(false);
      return;
    }

    const emailToVerify = pendingVerification.email;

    try {
      await apiCall('/auth/verify-email', 'POST', {
        email: emailToVerify,
        code: verificationCode
      });

      setShowVerification(false);
      setPendingVerification(null);
      setVerificationCode('');
      showMessage('Email verified successfully! Redirecting to login...', 'success');

      setTimeout(() => {
        setActiveForm('login');
      }, 1200);
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsLoading(false);
    }
  };

  const handleForgotPasswordSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      await apiCall('/auth/forgot-password', 'POST', {
        email: forgotEmail
      });

      showMessage('Password reset link sent to your email!', 'success');
      setShowForgotPassword(false);
      setForgotEmail('');
    } catch (error) {
      // Error handled in apiCall
    } finally {
      setIsLoading(false);
    }
  };

  const resendVerificationCode = async () => {
    if (!pendingVerification?.email) {
      showMessage('No email to resend code to. Please register first.', 'error');
      return;
    }
    try {
      await apiCall('/auth/send-verification', 'POST', { 
        email: pendingVerification.email 
      });
      showMessage('Verification code resent to your email!', 'success');
    } catch (error) {
      // Error handled in apiCall
    }
  };

  // Render Login Form
  const renderLoginForm = () => (
    <form onSubmit={handleLoginSubmit} className="space-y-4">
      <AuthIllustration type="login" />
      
      <SocialLoginButtons />
      
      <div className="relative flex items-center my-4">
        <div className="flex-grow border-t border-gray-300"></div>
        <span className="flex-shrink mx-4 text-gray-600 text-xs">Or continue with email</span>
        <div className="flex-grow border-t border-gray-300"></div>
      </div>

      <div>
        <label htmlFor="email" className="block text-sm font-medium text-gray-700 mb-1">
          Email Address
        </label>
        <input
          type="email"
          id="email"
          className="w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
          placeholder="Enter your email"
          value={loginData.email}
          onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}
          required
        />
      </div>

      <div>
        <label htmlFor="password" className="block text-sm font-medium text-gray-700 mb-1">
          Password
        </label>
        <div className="relative">
          <input
            type={passwordVisible.login ? "text" : "password"}
            id="password"
            className="w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 pr-12"
            placeholder="Enter your password"
            value={loginData.password}
            onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}
            required
          />
          <button
            type="button"
            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded"
            onClick={() => togglePasswordVisibility('login')}
            aria-label={passwordVisible.login ? "Hide password" : "Show password"}
          >
            <EyeIcon visible={passwordVisible.login} />
          </button>
        </div>
      </div>

      <div className="flex items-center justify-between">
        <div className="flex items-center">
          <input
            type="checkbox"
            id="remember"
            className="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"
            checked={rememberMe}
            onChange={(e) => setRememberMe(e.target.checked)}
          />
          <label htmlFor="remember" className="ml-2 block text-sm text-gray-700">
            Remember me
          </label>
        </div>

        <button
          type="button"
          className="text-sm text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
          onClick={() => setShowForgotPassword(true)}
        >
          Forgot Password?
        </button>
      </div>

      <div>
        <label htmlFor="captcha" className="block text-sm font-medium text-gray-700 mb-1">
          Security Check: {captcha.question}
        </label>
        <input
          type="number"
          id="captcha"
          className="w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
          placeholder="Enter the answer"
          value={captchaInput}
          onChange={(e) => setCaptchaInput(e.target.value)}
          required
        />
      </div>

      <button
        type="submit"
        disabled={isLoading}
        className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-2.5 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center"
      >
        {isLoading ? (
                   <>
            <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Signing In...
          </>
        ) : (
          'Sign In'
        )}
      </button>

      <div className="text-center mt-3">
        <p className="text-sm text-gray-600">
          Don't have an account?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={() => setActiveForm('signup')}
          >
            Sign Up
          </button>
        </p>
      </div>
    </form>
  );

  // Render Signup Form
  const renderSignupForm = () => (
    <form onSubmit={handleSignupSubmit} className="space-y-4">
      <AuthIllustration type="signup" />
      
      <SocialLoginButtons />
      
      <div className="relative flex items-center my-4">
        <div className="flex-grow border-t border-gray-300"></div>
        <span className="flex-shrink mx-4 text-gray-600 text-xs">Or sign up with email</span>
        <div className="flex-grow border-t border-gray-300"></div>
      </div>

      <div>
        <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1">
          Full Name
        </label>
        <input
          type="text"
          id="name"
          className="w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
          placeholder="Enter your full name"
          value={signupData.name}
          onChange={(e) => setSignupData({ ...signupData, name: e.target.value })}
          required
        />
      </div>

      <div>
        <label htmlFor="signup-email" className="block text-sm font-medium text-gray-700 mb-1">
          Email Address
        </label>
        <input
          type="email"
          id="signup-email"
          className="w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
          placeholder="Enter your email"
          value={signupData.email}
          onChange={(e) => setSignupData({ ...signupData, email: e.target.value })}
          required
        />
      </div>

      <div>
        <label htmlFor="signup-password" className="block text-sm font-medium text-gray-700 mb-1">
          Password
          <button
            type="button"
            className="ml-2 text-xs text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={generatePassword}
          >
            Generate Strong Password
          </button>
        </label>
        <div className="relative">
          <input
            type={passwordVisible.signup ? "text" : "password"}
            id="signup-password"
            className="w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 pr-12"
            placeholder="Create a strong password"
            value={signupData.password}
            onChange={(e) => {
              setSignupData({ ...signupData, password: e.target.value });
              checkPasswordStrength(e.target.value);
            }}
            required
          />
          <button
            type="button"
            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded"
            onClick={() => togglePasswordVisibility('signup')}
            aria-label={passwordVisible.signup ? "Hide password" : "Show password"}
          >
            <EyeIcon visible={passwordVisible.signup} />
          </button>
        </div>

        {signupData.password && (
          <PasswordStrength strength={passwordStrength} />
        )}
      </div>

      <div>
        <label htmlFor="confirm-password" className="block text-sm font-medium text-gray-700 mb-1">
          Confirm Password
        </label>
        <div className="relative">
          <input
            type={passwordVisible.confirm ? "text" : "password"}
            id="confirm-password"
            className="w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 pr-12"
            placeholder="Confirm your password"
            value={signupData.confirmPassword}
            onChange={(e) => setSignupData({ ...signupData, confirmPassword: e.target.value })}
            required
          />
          <button
            type="button"
            className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors duration-200 p-1 rounded"
            onClick={() => togglePasswordVisibility('confirm')}
            aria-label={passwordVisible.confirm ? "Hide password" : "Show password"}
          >
            <EyeIcon visible={passwordVisible.confirm} />
          </button>
        </div>
      </div>

      <div>
        <label htmlFor="signup-captcha" className="block text-sm font-medium text-gray-700 mb-1">
          Security Check: {captcha.question}
        </label>
        <input
          type="number"
          id="signup-captcha"
          className="w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
          placeholder="Enter the answer"
          value={signupCaptchaInput}
          onChange={(e) => setSignupCaptchaInput(e.target.value)}
          required
        />
      </div>

      <div className="flex items-start">
        <input
          type="checkbox"
          id="terms"
          className="h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded mt-1"
          checked={termsAccepted}
          onChange={(e) => setTermsAccepted(e.target.checked)}
          required
        />
        <label htmlFor="terms" className="ml-2 block text-sm text-gray-700">
          I agree to the <a href="#" className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200">Terms and Conditions</a>
        </label>
      </div>

      <button
        type="submit"
        disabled={isLoading}
        className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-2.5 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center"
      >
        {isLoading ? (
          <>
            <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
              <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
              <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Creating Account...
          </>
        ) : (
          'Create Account'
        )}
      </button>

      <div className="text-center mt-3">
        <p className="text-sm text-gray-600">
          Already have an account?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={() => setActiveForm('login')}
          >
            Sign In
          </button>
        </p>
      </div>
    </form>
  );

  // Render Forgot Password Modal
  const renderForgotPasswordModal = () => (
    <Modal
      isOpen={showForgotPassword}
      onClose={() => setShowForgotPassword(false)}
      title="Reset Password"
    >
      <div className="text-center mb-4">
        <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-full flex items-center justify-center">
          <svg className="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
          </svg>
        </div>
      </div>
      
      <p className="text-gray-600 mb-6 text-center">
        Enter your email address and we'll send you a link to reset your password.
      </p>

      <form onSubmit={handleForgotPasswordSubmit} className="space-y-4">
        <div>
          <label htmlFor="forgot-email" className="block text-sm font-medium text-gray-700 mb-1">
            Email Address
          </label>
          <input
            type="email"
            id="forgot-email"
            className="w-full px-3 py-2.5 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200"
            placeholder="Enter your email"
            value={forgotEmail}
            onChange={(e) => setForgotEmail(e.target.value)}
            required
          />
        </div>

        <button
          type="submit"
          disabled={isLoading}
          className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-2.5 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
        >
          {isLoading ? (
            <>
              <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Sending...
            </>
          ) : (
            'Send Reset Link'
          )}
        </button>
      </form>
    </Modal>
  );

  // Render Verification Modal
  const renderVerificationModal = () => (
    <Modal
      isOpen={showVerification}
      onClose={() => {
        setShowVerification(false);
        setPendingVerification(null);
      }}
      title="Verify Your Email"
    >
      <div className="text-center mb-4">
        <div className="w-16 h-16 mx-auto mb-4 bg-gradient-to-br from-green-100 to-teal-100 rounded-full flex items-center justify-center">
          <svg className="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
          </svg>
        </div>
      </div>
      
      <p className="text-gray-600 mb-6 text-center">
        We've sent a verification code to <strong className="text-purple-600">{pendingVerification?.email}</strong>.
        Please enter the code below to verify your email address.
      </p>

      <form onSubmit={handleVerificationSubmit} className="space-y-4">
        <div>
          <label htmlFor="verification-code" className="block text-sm font-medium text-gray-700 mb-1">
            Verification Code
          </label>
          <input
            type="text"
            id="verification-code"
            className="w-full px-3 py-2.5 bg-gray-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-600 focus:border-transparent transition duration-200 text-center text-lg font-mono tracking-widest"
            placeholder="Enter verification code"
            value={verificationCode}
            onChange={(e) => setVerificationCode(e.target.value)}
            required
          />
        </div>

        <button
          type="submit"
          disabled={isLoading}
          className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-2.5 px-4 rounded-lg font-semibold hover:from-purple-700 hover:to-indigo-700 transition duration-200 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"
        >
          {isLoading ? (
            <>
              <svg className="animate-spin -ml-1 mr-2 h-4 w-4 text-white" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              Verifying...
            </>
          ) : (
            'Verify Email'
          )}
        </button>
      </form>

      <div className="text-center mt-4">
        <p className="text-sm text-gray-600">
          Didn't receive the code?{' '}
          <button
            type="button"
            className="text-purple-600 hover:text-purple-800 font-medium transition-colors duration-200"
            onClick={resendVerificationCode}
          >
            Resend Code
          </button>
        </p>
      </div>
    </Modal>
  );

  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 p-4 relative overflow-hidden">
      {/* Background decorative elements */}
      <div className="absolute inset-0 overflow-hidden">
        <div className="absolute -top-40 -right-40 w-80 h-80 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse"></div>
        <div className="absolute -bottom-40 -left-40 w-80 h-80 bg-indigo-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse animation-delay-2000"></div>
        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-80 h-80 bg-pink-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-pulse animation-delay-4000"></div>
      </div>

      {/* Main Container */}
      <div className="w-full max-w-md relative z-10">
        {/* Auth Form Container */}
        <div className="bg-white/95 backdrop-blur-xl rounded-2xl shadow-2xl p-6 animate-fade-in border border-white/30">
          {/* Logo/Header */}
          <div className="text-center mb-4">
            <div className="inline-flex items-center justify-center w-14 h-14 bg-gradient-to-br from-purple-600 to-indigo-600 rounded-full mb-3 shadow-lg">
              <svg className="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
            <h1 className="text-2xl font-bold text-gray-800">
              {activeForm === 'login' ? 'Welcome Back' : 'Join Dora'}
            </h1>
            <p className="text-gray-600 mt-1 text-sm">
              {activeForm === 'login'
                ? 'Sign in to continue to your account'
                : 'Create your account to get started'}
            </p>
          </div>

          {/* Render the appropriate form */}
          {activeForm === 'login' ? renderLoginForm() : renderSignupForm()}
        </div>

        {/* Terms notice */}
        <div className="mt-4 text-center">
          <p className="text-xs text-white/80">
            By creating an account or continuing with Google, you agree to Dora's{' '}
            <a href="#" className="underline hover:text-white transition-colors">Terms & Conditions</a>{' '}
            and{' '}
            <a href="#" className="underline hover:text-white transition-colors">Privacy Policy</a>.
          </p>
        </div>
      </div>

      {/* Modals */}
      {renderForgotPasswordModal()}
      {renderVerificationModal()}

      {/* Success/Error Messages */}
      <div className="fixed top-4 right-4 z-50 max-w-sm w-full space-y-2">
        {messages.map(msg => (
          <Message
            key={msg.id}
            message={msg.message}
            type={msg.type}
            onClose={() => setMessages(prev => prev.filter(m => m.id !== msg.id))}
          />
        ))}
      </div>
    </div>
  );
};

export default AuthForm;